<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Leap & Learn Editor</title>
<style>
  :root { --primary: #7cf9ff; --dark: #0a1730; --panel: #142342; --text: #eaf6ff; }
  body { margin:0; display:flex; height:100vh; background: #050b1a; color: var(--text); font-family: sans-serif; overflow:hidden; }
  
  /* SIDEBAR */
  #EDITOR { width: 400px; background: var(--dark); border-right: 1px solid #333; display:flex; flex-direction:column; z-index:10; }
  #EDITOR_HEADER { padding:15px; background:var(--panel); border-bottom:1px solid #333; display:flex; align-items:center; justify-content:space-between; }
  #EDITOR_HEADER h2 { margin:0; font-size:18px; color:var(--primary); }
  
  #TABS { display:flex; background:#000; }
  .tab { flex:1; padding:10px; text-align:center; cursor:pointer; background:#111; color:#777; border-bottom:2px solid transparent; font-size:12px; font-weight:bold; }
  .tab.active { background:var(--panel); color:var(--primary); border-bottom:2px solid var(--primary); }
  
  #CONTROLS { flex:1; overflow-y:auto; padding:15px; }
  
  /* FORM ELEMENTS */
  .group { margin-bottom:20px; border-bottom:1px solid #222; padding-bottom:15px; }
  .group h3 { margin:0 0 10px; font-size:14px; color:#aaa; text-transform:uppercase; }
  label { display:block; font-size:12px; margin-bottom:4px; margin-top:10px; color:#ccc; }
  input[type="text"], input[type="number"], select, textarea { 
    width:100%; box-sizing:border-box; padding:8px; background:#000; border:1px solid #444; color:#fff; border-radius:4px; 
  }
  input[type="color"] { width:100%; height:30px; border:none; background:none; cursor:pointer; }
  
  .row { display:flex; gap:10px; }
  .col { flex:1; }

  /* LEVEL EDITOR */
  .level-item { background:rgba(255,255,255,0.05); border:1px solid #333; margin-bottom:10px; border-radius:4px; overflow:hidden; }
  .level-header { padding:10px; background:#222; cursor:pointer; font-weight:bold; display:flex; justify-content:space-between; }
  .level-content { padding:10px; display:none; }
  .level-content.show { display:block; }
  
  .q-item { background:rgba(0,0,0,0.3); padding:8px; margin-bottom:8px; border-left:2px solid var(--primary); }
  .btn { width:100%; padding:10px; cursor:pointer; background:var(--primary); color:#000; font-weight:bold; border:none; border-radius:4px; margin-top:5px; }
  .btn:hover { opacity:0.9; }
  .btn.danger { background:#ff3b3b; color:#fff; margin-top:5px; }
  .btn.small { width:auto; padding:4px 8px; font-size:10px; }
  
  /* PREVIEW */
  #PREVIEW_AREA { flex:1; background:#000; position:relative; display:flex; flex-direction:column; }
  #PREVIEW_BAR { height:40px; background:#111; display:flex; align-items:center; justify-content:center; color:#555; font-size:12px; border-bottom:1px solid #333; }
  iframe { border:none; width:100%; flex:1; background:#fff; }
  
  /* COPY OVERLAY */
  #COPY_MODAL { position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:none; align-items:center; justify-content:center; flex-direction:column; }
  #COPY_MODAL textarea { width:600px; height:300px; margin-bottom:10px; }
</style>
</head>
<body>

<!-- EDITOR SIDEBAR -->
<div id="EDITOR">
  <div id="EDITOR_HEADER">
    <h2>üê∏ Leap & Learn Editor</h2>
  </div>
  
  <div id="TABS">
    <div class="tab active" onclick="setTab('visuals')">–í–ò–ó–£–ê–õ</div>
    <div class="tab" onclick="setTab('gameplay')">–ì–ï–ô–ú–ü–õ–ï–ô</div>
    <div class="tab" onclick="setTab('levels')">–£–†–û–í–ù–ò</div>
  </div>
  
  <div id="CONTROLS">
    
    <!-- VISUALS TAB -->
    <div id="tab-visuals">
      <div class="group">
        <h3>–õ–æ–∫–∞—Ü–∏—è –∏ –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
        <label>–§–æ–Ω (–õ–æ–∫–∞—Ü–∏—è)</label>
        <select id="bgSelect" onchange="updatePreview()">
          <option value="river">–†–µ–∫–∞</option>
          <option value="lava">–õ–∞–≤–∞</option>
          <option value="swamp">–ë–æ–ª–æ—Ç–æ</option>
          <option value="custom">–°–≤–æ—è —Å—Å—ã–ª–∫–∞...</option>
        </select>
        <input type="text" id="bgCustom" placeholder="https://..." style="display:none; margin-top:5px;" oninput="updatePreview()">

        <label>–ü–µ—Ä—Å–æ–Ω–∞–∂</label>
        <select id="charSelect" onchange="updatePreview()">
          <option value="frog">–õ—è–≥—É—à–∫–∞</option>
          <option value="chameleon">–•–∞–º–µ–ª–µ–æ–Ω</option>
          <option value="lizard">–Ø—â–µ—Ä–∏—Ü–∞</option>
          <option value="custom">–°–≤–æ—è —Å—Å—ã–ª–∫–∞...</option>
        </select>
        <input type="text" id="charCustom" placeholder="https://..." style="display:none; margin-top:5px;" oninput="updatePreview()">

        <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
        <select id="platSelect" onchange="updatePreview()">
          <option value="lily">–õ–∏–ª–∏—è (–ö—É–≤—à–∏–Ω–∫–∞)</option>
          <option value="stone">–ö–∞–º–µ–Ω—å</option>
          <option value="mound">–ë–æ–ª–æ—Ç–Ω–∞—è –∫–æ—á–∫–∞</option>
          <option value="custom">–°–≤–æ—è —Å—Å—ã–ª–∫–∞...</option>
        </select>
        <input type="text" id="platCustom" placeholder="https://..." style="display:none; margin-top:5px;" oninput="updatePreview()">
      </div>

      <div class="group">
        <h3>–¶–≤–µ—Ç–∞ –∏ –¢–µ–∫—Å—Ç</h3>
        <label>–û—Å–Ω–æ–≤–Ω–æ–π –Ω–µ–æ–Ω–æ–≤—ã–π —Ü–≤–µ—Ç</label>
        <input type="color" id="colNeon" value="#7cf9ff" oninput="updatePreview()">
        
        <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (–≠–∫—Ä–∞–Ω—ã)</label>
        <input type="color" id="colBg" value="#0a1730" oninput="updatePreview()">

        <label>–¶–≤–µ—Ç —à—Ä–∏—Ñ—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞</label>
        <div class="row">
            <input type="color" id="colFont" value="#0b1630" oninput="updatePreview()">
            <select id="shadowMode" onchange="updatePreview()">
                <option value="on">–° —Ç–µ–Ω—å—é (–¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ)</option>
                <option value="off">–ë–µ–∑ —Ç–µ–Ω–∏ (–¥–ª—è —Ç–µ–º–Ω–æ–≥–æ)</option>
            </select>
        </div>

        <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞ (px)</label>
        <input type="number" id="fontSize" value="40" oninput="updatePreview()">
      </div>
    </div>

    <!-- GAMEPLAY TAB -->
    <div id="tab-gameplay" style="display:none">
      <div class="group">
        <h3>–°–ª–æ–∂–Ω–æ—Å—Ç—å (–¢–∞–π–º–µ—Ä)</h3>
        <div class="row">
          <div class="col"><label>–≠—Ç–∞–ø 1 (—Å–µ–∫)</label><input type="number" id="time1" value="10"></div>
          <div class="col"><label>–≠—Ç–∞–ø 2</label><input type="number" id="time2" value="7"></div>
          <div class="col"><label>–≠—Ç–∞–ø 3</label><input type="number" id="time3" value="5"></div>
        </div>
        <small style="color:#777">–¢–∞–π–º–µ—Ä —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ 3 –∏ 6 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.</small>
      </div>

      <div class="group">
        <h3>–ê—É–¥–∏–æ (–°—Å—ã–ª–∫–∏ mp3)</h3>
        <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</label>
        <input type="text" id="audWin" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ">
        <label>–û—à–∏–±–∫–∞</label>
        <input type="text" id="audFail" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ">
        <label>–ü–æ–±–µ–¥–∞ (–§–∏–Ω–∞–ª)</label>
        <input type="text" id="audFinalWin" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ">
        <label>–ü—Ä–æ–∏–≥—Ä—ã—à (–§–∏–Ω–∞–ª)</label>
        <input type="text" id="audFinalLose" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ">
      </div>

      <div class="group">
        <h3>–¢–µ–∫—Å—Ç—ã —Ñ–∏–Ω–∞–ª–∞</h3>
        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label>
        <input type="text" id="txtWin" value="CONGRATULATIONS!">
        <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label>
        <input type="text" id="subWin" value="LEVEL COMPLETE">
        
        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ—Ä–∞–∂–µ–Ω–∏—è</label>
        <input type="text" id="txtLose" value="YOU LOST!">
        <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ—Ä–∞–∂–µ–Ω–∏—è</label>
        <input type="text" id="subLose" value="TRY AGAIN">
      </div>
    </div>

    <!-- LEVELS TAB -->
    <div id="tab-levels" style="display:none">
      <div id="levelsContainer"></div>
      <button class="btn" onclick="addLevel()">+ –î–û–ë–ê–í–ò–¢–¨ –£–†–û–í–ï–ù–¨</button>
    </div>

    <br><br>
    <button class="btn" style="background:#4dff88; padding:15px;" onclick="generateCode()">üìã –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î –î–õ–Ø GENIALLY</button>
  </div>
</div>

<!-- PREVIEW AREA -->
<div id="PREVIEW_AREA">
  <div id="PREVIEW_BAR">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)</div>
  <iframe id="previewFrame"></iframe>
</div>

<!-- COPY MODAL -->
<div id="COPY_MODAL">
  <h2 style="color:#fff">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥:</h2>
  <textarea id="finalCode"></textarea>
  <button class="btn" style="width:200px" onclick="document.getElementById('COPY_MODAL').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
</div>

<!-- TEMPLATE SCRIPT -->
<script>
// --- ASSETS DATABASE ---
const ASSETS = {
  bg: {
    river: "https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png",
    lava: "https://img.genially.com/67961b32a116fb001568a75e/fa2ab459-fec9-4ccd-97e3-254427b4ade0.png",
    swamp: "https://img.genially.com/67961b32a116fb001568a75e/02b52ad4-9d31-4b21-a305-8fec6e8a4487.png"
  },
  char: {
    frog: "https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png",
    chameleon: "https://img.genially.com/67961b32a116fb001568a75e/74b56fcf-5354-43dd-9c9a-f50facc9a9bf.png",
    lizard: "https://img.genially.com/67961b32a116fb001568a75e/0feda2a1-485a-4654-8640-bf1adcc9f9ec.png"
  },
  plat: {
    lily: "https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png",
    stone: "https://img.genially.com/67961b32a116fb001568a75e/bad37c6d-f04c-45c0-b954-807d79ec3a95.png",
    mound: "https://img.genially.com/67961b32a116fb001568a75e/c6775617-bde5-43e4-9da8-5332d928807e.png"
  }
};

// --- DEFAULT STATE ---
let levelsData = [
  {
    name: "–£—Ä–æ–≤–µ–Ω—å 1",
    questions: [
      { text: "2 + 2 = ?", answers: ["3", "4", "5"], correct: 1 },
      { text: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?", answers: ["–õ–æ–Ω–¥–æ–Ω", "–ë–µ—Ä–ª–∏–Ω", "–ü–∞—Ä–∏–∂"], correct: 2 }
    ]
  }
];

// --- EDITOR LOGIC ---
function setTab(name) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('#CONTROLS > div').forEach(d=>d.style.display='none');
  document.getElementById('tab-'+name).style.display='block';
  if(name === 'gameplay') updatePreview(); 
}

function toggleCustom(selectId, inputId) {
  const val = document.getElementById(selectId).value;
  document.getElementById(inputId).style.display = (val === 'custom') ? 'block' : 'none';
}
document.getElementById('bgSelect').addEventListener('change', ()=>toggleCustom('bgSelect','bgCustom'));
document.getElementById('charSelect').addEventListener('change', ()=>toggleCustom('charSelect','charCustom'));
document.getElementById('platSelect').addEventListener('change', ()=>toggleCustom('platSelect','platCustom'));

// LEVEL EDITOR RENDER
function renderLevels() {
  const c = document.getElementById('levelsContainer');
  c.innerHTML = '';
  levelsData.forEach((lvl, lIdx) => {
    const div = document.createElement('div');
    div.className = 'level-item';
    div.innerHTML = `
      <div class="level-header" onclick="this.nextElementSibling.classList.toggle('show')">
        ${lvl.name} (${lvl.questions.length} –≤–æ–ø—Ä.) <span>‚ñº</span>
      </div>
      <div class="level-content">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è</label>
        <input type="text" value="${lvl.name}" oninput="levelsData[${lIdx}].name=this.value; updatePreview()">
        <br><br>
        <div id="qList_${lIdx}"></div>
        <button class="btn small" onclick="addQuestion(${lIdx})">+ –í–æ–ø—Ä–æ—Å</button>
        <button class="btn small danger" onclick="removeLevel(${lIdx})">–£–¥–∞–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
      </div>
    `;
    c.appendChild(div);
    
    const qList = div.querySelector(`#qList_${lIdx}`);
    lvl.questions.forEach((q, qIdx) => {
      const qDiv = document.createElement('div');
      qDiv.className = 'q-item';
      qDiv.innerHTML = `
        <label>–í–æ–ø—Ä–æ—Å:</label>
        <input type="text" value="${q.text}" onchange="updateQ(${lIdx},${qIdx},'text',this.value)">
        <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (–æ—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):</label>
        ${q.answers.map((ans, aIdx) => `
          <div class="row" style="margin-bottom:2px">
            <input type="radio" name="corr_${lIdx}_${qIdx}" ${aIdx===q.correct?'checked':''} onchange="updateQ(${lIdx},${qIdx},'correct',${aIdx})">
            <input type="text" value="${ans}" onchange="updateQ(${lIdx},${qIdx},'ans_${aIdx}',this.value)">
          </div>
        `).join('')}
        <button class="btn small danger" onclick="removeQ(${lIdx},${qIdx})">x</button>
      `;
      qList.appendChild(qDiv);
    });
  });
}

function addLevel() {
  levelsData.push({ name: "–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å", questions: [] });
  renderLevels();
  updatePreview();
}
function removeLevel(idx) {
  if(confirm('–£–¥–∞–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å?')) {
    levelsData.splice(idx,1);
    renderLevels();
    updatePreview();
  }
}
function addQuestion(lIdx) {
  levelsData[lIdx].questions.push({ text: "–í–æ–ø—Ä–æ—Å...", answers: ["–ê","–ë","–í"], correct: 0 });
  renderLevels();
  updatePreview();
}
function removeQ(lIdx, qIdx) {
  levelsData[lIdx].questions.splice(qIdx,1);
  renderLevels();
  updatePreview();
}
function updateQ(lIdx, qIdx, field, val) {
  if(field === 'text') levelsData[lIdx].questions[qIdx].text = val;
  if(field === 'correct') levelsData[lIdx].questions[qIdx].correct = parseInt(val);
  if(field.startsWith('ans_')) {
    const aIdx = parseInt(field.split('_')[1]);
    levelsData[lIdx].questions[qIdx].answers[aIdx] = val;
  }
  updatePreview(); // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏
}

// --- GENERATE GAME HTML ---
function getGameHTML() {
  // 1. Gather Settings
  const getVal = (id) => document.getElementById(id).value;
  
  const bgType = getVal('bgSelect');
  const bgUrl = bgType === 'custom' ? getVal('bgCustom') : ASSETS.bg[bgType];
  
  const charType = getVal('charSelect');
  const charUrl = charType === 'custom' ? getVal('charCustom') : ASSETS.char[charType];
  
  const platType = getVal('platSelect');
  const platUrl = platType === 'custom' ? getVal('platCustom') : ASSETS.plat[platType];

  const colNeon = getVal('colNeon');
  const colBg = getVal('colBg');
  const colFont = getVal('colFont');
  const fontSize = getVal('fontSize');
  const shadowMode = getVal('shadowMode');
  const fontShadow = shadowMode === 'on' ? `text-shadow:0 2px 0 rgba(0,0,0,.35)` : `text-shadow:none`;

  const times = { t1: parseInt(getVal('time1')), t2: parseInt(getVal('time2')), t3: parseInt(getVal('time3')) };
  
  const audioCfg = {
    win: getVal('audWin'),
    fail: getVal('audFail'),
    finalWin: getVal('audFinalWin'),
    finalLose: getVal('audFinalLose')
  };

  const texts = {
    winH: getVal('txtWin'), winS: getVal('subWin'),
    loseH: getVal('txtLose'), loseS: getVal('subLose')
  };

  // 2. Base Template (Based on provided code, minified slightly)
  // –ú—ã –≤—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥ –≤ –Ω–∞—á–∞–ª–æ JS, –∞ —Å—Ç–∏–ª–∏ –≤ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  return `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Leap & Learn</title>
<style>
:root{
  --neon-main: ${colNeon};
  --bg-color: ${colBg};
  --bg-img: url("${bgUrl}");
  --char-img: url("${charUrl}");
  --plat-img: url("${platUrl}");
  --font-col: ${colFont};
  --font-size: ${fontSize}px;
  --danger:#ff3b3b;
  --win:#ffe44d;
}
html,body{margin:0;width:100%;height:100%;overflow:hidden;font-family:Arial;background:var(--bg-color)}
#GAME{position:relative;width:100%;height:100%}
#GAME.shake{animation:shake .25s}
@keyframes shake{0%{transform:translate(0)}25%{transform:translate(-4px,3px)}50%{transform:translate(4px,-3px)}75%{transform:translate(-3px,2px)}100%{transform:translate(0)}}
#BG{position:absolute;inset:0;z-index:0;background:var(--bg-img) center/cover no-repeat}
#SCORE{position:absolute;top:30px;left:30px;font-size:20px;font-weight:900;z-index:20;color:#fff;text-shadow:0 2px 0 rgba(0,0,0,.35)}
#TIMER{position:absolute;top:26px;left:120px;height:38px;border-radius:18px;display:flex;align-items:center;justify-content:center;gap:10px;padding:0 14px;background:rgba(255,255,255,.95);border:2px solid var(--neon-main);box-shadow:0 0 18px var(--neon-main);z-index:20;font-weight:900;color:#053149}
#CLOCK_ICON{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center}
#TIMER.danger{border-color:var(--danger);color:var(--danger);box-shadow:0 0 25px var(--danger);animation:timerPulse .8s infinite}
@keyframes timerPulse{50%{transform:scale(1.07)}}
#LIVES{position:absolute;top:30px;right:30px;font-size:26px;z-index:20}
#QUESTION{position:absolute;top:18px;width:100%;display:flex;justify-content:center;z-index:20}
#QUESTION_TXT{font-size:var(--font-size);font-weight:900;color:var(--font-col);padding:10px 18px;border-radius:18px;background:rgba(255,255,255,.72);border:1px solid rgba(124,249,255,.40);box-shadow:0 0 18px rgba(124,249,255,.25);${fontShadow}}
#COMBO{position:absolute;top:165px;left:50%;transform:translateX(-50%);z-index:20;padding:10px 16px;border-radius:18px;background:rgba(255,255,255,.88);border:2px solid var(--neon-main);box-shadow:0 0 18px var(--neon-main);font-weight:900;color:#043149;display:none;gap:10px;align-items:center}
#COMBO.show{display:inline-flex}
#COMBO_BOLT{width:18px;height:18px;border-radius:6px;background:rgba(124,249,255,.25);display:inline-block}
#COMBO.pulse{animation:comboPulse .55s ease}
@keyframes comboPulse{0%{transform:translateX(-50%) translateY(10px) scale(.92);opacity:0}40%{transform:translateX(-50%) translateY(0px) scale(1.14);opacity:1}100%{transform:translateX(-50%) translateY(0px) scale(1);opacity:1}}
.btn{padding:12px 34px;border-radius:16px;font-weight:900;background:#fff;border:2px solid var(--neon-main);box-shadow:0 0 15px var(--neon-main);cursor:pointer;color:#043149}
.btn:active{transform:translateY(1px)}
.btn.dark{background:rgba(255,255,255,.10);color:#eaf6ff;border:2px solid var(--neon-main)}
#START.hide{display:none}
#START_SCREEN{position:absolute;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;background:rgba(8,16,34,.92)}
#START_CARD{width:min(760px, calc(100vw - 40px));border-radius:26px;background:linear-gradient(180deg, var(--bg-color), rgba(5,10,25,.92));border:2px solid var(--neon-main);box-shadow:0 0 30px var(--neon-main);padding:18px;position:relative;overflow:hidden;color:#eaf6ff}
#START_TOP{position:relative;display:flex;align-items:center;gap:14px;padding:6px}
#START_ICON{width:64px;height:64px;flex:0 0 auto;background:var(--char-img) no-repeat center/contain}
#START_TITLE{font-weight:900;font-size:34px;color:#eaf6ff;text-shadow:0 0 18px var(--neon-main);margin:0}
.panel{background:rgba(255,255,255,.08);border:1px solid var(--neon-main);border-radius:18px;padding:12px;margin-top:10px}
#END{position:absolute;inset:0;z-index:50;background:rgba(8,16,34,.92);display:none;align-items:center;justify-content:center;flex-direction:column}
#END.show{display:flex}
#END_TEXT{font-size:58px;font-weight:900;margin:0 0 10px;text-align:center}
.win{color:var(--win);text-shadow:0 0 12px var(--win)}
.lose{color:var(--danger);text-shadow:0 0 12px var(--danger)}
#LEVEL_BANNER{margin:0 0 10px;padding:14px 18px;border-radius:20px;background:rgba(255,255,255,.12);border:1px solid var(--win);color:#fff7cf;font-weight:900;text-transform:uppercase;text-align:center}
#LEVEL_NAME{margin:0 0 10px;color:#bfe9ff;font-weight:900}
#SCORECARD{width:min(620px, calc(100vw - 40px));background:rgba(255,255,255,.10);border:2px solid var(--neon-main);border-radius:22px;padding:18px;margin:6px 0 16px;color:#eaf6ff}
#SCOREGRID{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row{display:flex;justify-content:space-between;background:rgba(255,255,255,.08);padding:12px;border-radius:16px}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}
#FROG_WRAP{position:absolute;left:calc(160px - 17mm + 15mm - 11mm);top:calc(50% + 13mm - 11mm);width:110px;height:110px;z-index:15;pointer-events:none;animation:float 3.5s ease-in-out infinite}
#FROG{width:110px;height:110px;background:var(--char-img) no-repeat center/contain;position:absolute;left:50%;top:50%;transform:translate(-50%,-65%);transition:transform .6s ease,opacity .6s ease}
#FROG.jump{transform:translate(-50%,-95%) scale(1.05)}
#FROG.sink{transform:translate(-50%,-10%) scale(.6);opacity:0}
#PLATFORMS{position:absolute;inset:0;z-index:10}
.platform{position:absolute;width:150px;height:150px;transition:transform .5s,opacity .6s}
.lily{width:150px;height:150px;background:var(--plat-img) no-repeat center/contain;display:flex;align-items:center;justify-content:center;font-weight:900;color:#141414;text-shadow:0 2px 0 rgba(255,255,255,.65);animation:float 3.5s ease-in-out infinite;cursor:pointer}
.platform.fade{opacity:0}
.platform.wrong .lily{filter:drop-shadow(0 0 18px red)}
#FX{position:absolute;inset:0;pointer-events:none;z-index:200}
</style>
</head>
<body>
<div id="GAME">
  <div id="BG"></div><div id="SCORE">‚≠ê 0</div>
  <div id="TIMER"><span id="CLOCK_ICON">‚è±Ô∏è</span><span id="TIMER_TXT">00:00</span></div>
  <div id="QUESTION"><span id="QUESTION_TXT"></span></div>
  <div id="COMBO"><span id="COMBO_BOLT"></span><span id="COMBO_TXT">COMBO x1.0</span></div>
  <div id="LIVES"></div>
  <div id="START_SCREEN">
    <div id="START_CARD">
      <div id="START_TOP"><div id="START_ICON"></div><div><h1 id="START_TITLE">Leap & Learn</h1></div></div>
      <div class="panel"><h3>How to Play</h3><ul class="rules"><li>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.</li><li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–∞–π–º–µ—Ä–æ–º!</li></ul></div>
      <div style="margin-top:12px;text-align:center"><button id="START_BTN" class="btn">‚ñ∂ START</button></div>
    </div>
  </div>
  <div id="END">
    <div id="END_TEXT"></div><div id="LEVEL_BANNER">LEVEL COMPLETE</div><div id="LEVEL_NAME"></div>
    <div id="SCORECARD"><div id="SCOREGRID">
        <div class="row"><div>Questions</div><div id="STAT_Q">0/0</div></div>
        <div class="row"><div>Score</div><div id="FINAL_SCORE">0</div></div>
    </div></div>
    <div id="END_BTNS"><button id="NEXT_LEVEL" class="btn">‚è≠ Next</button><button id="RETRY" class="btn">üîÅ Play again</button></div>
  </div>
  <div id="FX"></div>
  <div id="FROG_WRAP"><div id="FROG"></div></div>
  <div id="PLATFORMS"></div>
</div>

<script>
/* USER CONFIG */
const LEVELS = ${JSON.stringify(levelsData)};
const CFG_TIME = ${JSON.stringify(times)};
const CFG_AUDIO = ${JSON.stringify(audioCfg)};
const CFG_TEXT = ${JSON.stringify(texts)};

/* ENGINE */
const Q_TXT=document.getElementById("QUESTION_TXT"),T=document.getElementById("TIMER"),T_TXT=document.getElementById("TIMER_TXT"),L=document.getElementById("LIVES"),S=document.getElementById("SCORE"),P=document.getElementById("PLATFORMS"),FROG=document.getElementById("FROG");
const END=document.getElementById("END"),END_TXT=document.getElementById("END_TEXT"),STAT_Q=document.getElementById("STAT_Q"),FINAL_SCORE=document.getElementById("FINAL_SCORE");
let q=0,lives=5,score=0,started=false,timer=null,timeLeft=0,levelIndex=0,combo=0;
let QUESTIONS=[];

const ctx=new (AudioContext||webkitAudioContext)();
function playSound(type){
  const url = CFG_AUDIO[type];
  if(url && url.length>5) { new Audio(url).play().catch(e=>console.log(e)); return; }
  // Fallback synths
  const t=ctx.currentTime;
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.connect(g);g.connect(ctx.destination);
  if(type==='win'){
     o.frequency.setValueAtTime(523,t); o.frequency.linearRampToValueAtTime(784,t+0.1);
     g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(0.2,t+0.05); g.gain.exponentialRampToValueAtTime(0.01,t+0.3);
     o.start(t); o.stop(t+0.4);
  } else if(type==='fail'){
     o.type='sawtooth'; o.frequency.setValueAtTime(200,t); o.frequency.linearRampToValueAtTime(100,t+0.2);
     g.gain.setValueAtTime(0.2,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.3);
     o.start(t); o.stop(t+0.4);
  }
}

function getRoundTime(){
  if(combo<3) return CFG_TIME.t1;
  if(combo<6) return CFG_TIME.t2;
  return CFG_TIME.t3;
}

function render(){
  P.innerHTML=""; FROG.classList.remove("sink");
  if(q>=QUESTIONS.length) { showEnd(true); return; }
  Q_TXT.textContent=QUESTIONS[q].text;
  L.textContent="‚ù§Ô∏è".repeat(lives); S.textContent="‚≠ê "+score;
  
  const STEP=190, y=window.innerHeight/2 + 76;
  const count=Math.ceil((window.innerWidth-160)/STEP)+4;
  for(let i=0;i<count;i++){
    const d=document.createElement("div"); d.className="platform";
    d.style.left=160+STEP*i-75+"px"; d.style.top=y-75+"px";
    const lily=document.createElement("div"); lily.className="lily";
    if(i>0 && i<=QUESTIONS[q].answers.length){
      lily.textContent=QUESTIONS[q].answers[i-1];
      d.onclick=()=>pick(i,d);
    }
    d.appendChild(lily); P.appendChild(d);
  }
}

function pick(i,el){
  if(!started) return;
  clearInterval(timer);
  FROG.classList.add("jump"); setTimeout(()=>FROG.classList.remove("jump"),300);
  document.querySelectorAll(".platform").forEach(p=>p.style.transform=\`translateX(\${-(el.offsetLeft+75-160)}px)\`);
  setTimeout(()=>{
    if(i-1===QUESTIONS[q].correct){
      playSound('win'); score+=100+(timeLeft*10); combo++; q++;
      if(q>=QUESTIONS.length) showEnd(true); else startRound();
    } else {
      fail();
    }
  },500);
}

function fail(){
  playSound('fail'); lives--; combo=0;
  FROG.classList.add("sink");
  document.querySelectorAll(".platform").forEach(p=>p.classList.add("fade","wrong"));
  setTimeout(()=>{ lives<=0 ? showEnd(false) : startRound(); },900);
}

function startRound(){
  render(); clearInterval(timer);
  timeLeft=getRoundTime();
  T_TXT.textContent="00:"+String(timeLeft).padStart(2,"0");
  T.classList.remove("danger");
  timer=setInterval(()=>{
    timeLeft--;
    if(timeLeft<=0){ clearInterval(timer); fail(); return; }
    T_TXT.textContent="00:"+String(timeLeft).padStart(2,"0");
    if(timeLeft<=3) T.classList.add("danger");
  },1000);
}

function showEnd(win){
  clearInterval(timer); END.classList.add("show");
  document.getElementById("LEVEL_NAME").textContent = LEVELS[levelIndex].name;
  STAT_Q.textContent = \`\${q}/\${QUESTIONS.length}\`;
  FINAL_SCORE.textContent = score;
  
  if(win){
    END_TXT.textContent = CFG_TEXT.winH;
    END_TXT.className = "win";
    document.getElementById("LEVEL_BANNER").textContent = CFG_TEXT.winS;
    playSound('finalWin');
    document.getElementById("NEXT_LEVEL").style.display = (levelIndex<LEVELS.length-1) ? "inline-block" : "none";
  } else {
    END_TXT.textContent = CFG_TEXT.loseH;
    END_TXT.className = "lose";
    document.getElementById("LEVEL_BANNER").textContent = CFG_TEXT.loseS;
    playSound('finalLose');
    document.getElementById("NEXT_LEVEL").style.display = "none";
  }
}

function startLevel(idx){
  levelIndex=idx; QUESTIONS=LEVELS[idx].questions;
  q=0; lives=5; score=0; combo=0;
  document.getElementById("START_SCREEN").style.display="none";
  END.classList.remove("show");
  started=true; startRound();
}

document.getElementById("START_BTN").onclick=()=>{ ctx.resume(); startLevel(0); };
document.getElementById("RETRY").onclick=()=>{ startLevel(levelIndex); };
document.getElementById("NEXT_LEVEL").onclick=()=>{ startLevel(levelIndex+1); };

window.onresize=render;
render();
<\/script></body></html>`;
}

function updatePreview() {
  const html = getGameHTML();
  document.getElementById('previewFrame').srcdoc = html;
}

function generateCode() {
  const html = getGameHTML();
  const iframeCode = `<iframe style="width:100%;height:100%;border:0" srcdoc='${html.replace(/'/g, "&#39;")}'></iframe>`;
  
  document.getElementById('finalCode').value = iframeCode;
  document.getElementById('COPY_MODAL').style.display = 'flex';
}

// Init
renderLevels();
updatePreview();
</script>
</body>
</html>
