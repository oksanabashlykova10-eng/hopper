<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Leap & Learn Ultimate Editor Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #111827;
            --panel-bg: #1f2937;
            --sidebar-w: 400px;
            --accent: #10b981;
            --text-main: #f3f4f6;
            --border: #374151;
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #000; color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        aside { width: var(--sidebar-w); background: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .tabs { display: flex; background: #111827; border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 12px 5px; background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        
        .content { flex: 1; overflow-y: auto; padding: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #9ca3af; margin-bottom: 5px; }
        
        input, select, textarea { width: 100%; background: #111827; border: 1px solid var(--border); color: #fff; padding: 8px; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 120px; font-family: monospace; font-size: 12px; line-height: 1.5; }

        .asset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .asset-box { border: 2px solid transparent; border-radius: 4px; cursor: pointer; height: 50px; background: #000; overflow: hidden; }
        .asset-box img { width: 100%; height: 100%; object-fit: cover; }
        .asset-box.active { border-color: #3b82f6; }

        /* PREVIEW AREA */
        main { flex: 1; display: flex; flex-direction: column; position: relative; background: #0f172a; }
        .preview-nav { padding: 10px; background: #111827; display: flex; justify-content: center; gap: 10px; }
        .nav-btn { padding: 6px 15px; border-radius: 20px; border: none; cursor: pointer; font-size: 12px; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .btn-rules { background: #5eead4; color: #000; }
        .btn-game { background: #818cf8; color: #fff; }
        
        iframe { flex: 1; border: none; background: #000; }

        .footer { padding: 15px; background: #111827; }
        .btn-save { width: 100%; background: #10b981; color: #fff; padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }

        .lvl-card { background: #2d3748; padding: 10px; border-radius: 6px; margin-bottom: 15px; position: relative; }
        .del-lvl { position: absolute; right: 10px; top: 10px; color: #f87171; cursor: pointer; }
    </style>
</head>
<body>

<aside>
    <div class="tabs">
        <button class="tab-btn active" onclick="setTab('visual')">–í–∏–∑—É–∞–ª</button>
        <button class="tab-btn" onclick="setTab('texts')">–¢–µ–∫—Å—Ç—ã</button>
        <button class="tab-btn" onclick="setTab('gameplay')">–ì–µ–π–º–ø–ª–µ–π</button>
        <button class="tab-btn" onclick="setTab('levels')">–£—Ä–æ–≤–Ω–∏</button>
    </div>

    <div id="tab-visual" class="content">
        <div class="form-group">
            <label>–õ–æ–∫–∞—Ü–∏—è (–§–æ–Ω)</label>
            <div class="asset-grid" id="bg-grid"></div>
            <input type="text" id="custom-bg" placeholder="–°–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ–Ω..." oninput="update()">
        </div>
        <div class="form-group">
            <label>–ü–µ—Ä—Å–æ–Ω–∞–∂</label>
            <div class="asset-grid" id="char-grid"></div>
            <input type="text" id="custom-char" placeholder="–°–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–µ—Ä–æ—è..." oninput="update()">
        </div>
        <div class="form-group">
            <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
            <div class="asset-grid" id="plat-grid"></div>
            <input type="text" id="custom-plat" placeholder="–°–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É..." oninput="update()">
        </div>
        <div class="form-group">
            <label>–¶–≤–µ—Ç –Ω–µ–æ–Ω–∞ –∏ —à—Ä–∏—Ñ—Ç–∞</label>
            <div style="display:flex; gap:10px">
                <input type="color" id="color-neon" value="#7cf9ff" onchange="update()">
                <input type="color" id="color-font" value="#000000" onchange="update()">
            </div>
        </div>
    </div>

    <div id="tab-levels" class="content" style="display:none">
        <div id="levels-list"></div>
        <button onclick="addLevel()" style="width:100%; padding:8px; background: #374151; color:white; border:none; cursor:pointer">+ –î–û–ë–ê–í–ò–¢–¨ –£–†–û–í–ï–ù–¨</button>
    </div>

    <div id="tab-texts" class="content" style="display:none">
        <div class="form-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–≥—Ä—ã</label><input type="text" id="t-title" value="Leap & Learn" oninput="update()"></div>
        <div class="form-group"><label>–¢–µ–∫—Å—Ç –ø–æ–±–µ–¥—ã</label><input type="text" id="t-win" value="CONGRATULATIONS!" oninput="update()"></div>
        <div class="form-group"><label>–¢–µ–∫—Å—Ç –ø—Ä–æ–≤–∞–ª–∞</label><input type="text" id="t-lose" value="GAME OVER!" oninput="update()"></div>
    </div>

    <div id="tab-gameplay" class="content" style="display:none">
        <div class="form-group"><label>–ö–æ–ª-–≤–æ –∂–∏–∑–Ω–µ–π</label><input type="number" id="g-lives" value="5" oninput="update()"></div>
        <div class="form-group"><label>–¢–∞–π–º–µ—Ä (—Å–µ–∫)</label><input type="number" id="g-time" value="10" oninput="update()"></div>
    </div>

    <div class="footer">
        <button class="btn-save" onclick="copyCode()">üìã –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î –î–õ–Ø GENIALLY</button>
    </div>
</aside>

<main>
    <div class="preview-nav">
        <button class="nav-btn btn-rules" onclick="previewMode('rules')"><i class="fas fa-eye"></i> –ü—Ä–∞–≤–∏–ª–∞</button>
        <button class="nav-btn btn-game" onclick="previewMode('game')"><i class="fas fa-gamepad"></i> –ò–≥—Ä–∞</button>
    </div>
    <iframe id="pre-frame"></iframe>
</main>

<script>
    const PRESETS = {
        bg: ['https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png', 'https://img.genially.com/67961b32a116fb001568a75e/fa2ab459-fec9-4ccd-97e3-254427b4ade0.png', 'https://img.genially.com/67961b32a116fb001568a75e/02b52ad4-9d31-4b21-a305-8fec6e8a4487.png'],
        char: ['https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png', 'https://img.genially.com/67961b32a116fb001568a75e/74b56fcf-5354-43dd-9c9a-f50facc9a9bf.png', 'https://img.genially.com/67961b32a116fb001568a75e/0feda2a1-485a-4654-8640-bf1adcc9f9ec.png'],
        plat: ['https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png', 'https://img.genially.com/67961b32a116fb001568a75e/bad37c6d-f04c-45c0-b954-807d79ec3a95.png', 'https://img.genially.com/67961b32a116fb001568a75e/c6775617-bde5-43e4-9da8-5332d928807e.png']
    };

    let state = {
        bg: PRESETS.bg[0], char: PRESETS.char[0], plat: PRESETS.plat[0],
        neon: '#7cf9ff', fontColor: '#000000',
        title: "Leap & Learn", winT: "CONGRATULATIONS!", loseT: "GAME OVER!",
        lives: 5, time: 10, mode: 'rules',
        levels: [{ name: "Level 1", questions: "I ___ a new bike.\nShe ___ got a brother.", answers: "have got | has got | is got\nhas | have | is" }]
    };

    function init() {
        renderGrid('bg-grid', PRESETS.bg, 'bg');
        renderGrid('char-grid', PRESETS.char, 'char');
        renderGrid('plat-grid', PRESETS.plat, 'plat');
        renderLevels();
        update();
    }

    function renderGrid(id, assets, key) {
        const container = document.getElementById(id);
        container.innerHTML = assets.map(url => `<div class="asset-box ${state[key] === url ? 'active' : ''}" onclick="selectAsset('${key}', '${url}')"><img src="${url}"></div>`).join('');
    }

    function selectAsset(key, url) {
        state[key] = url;
        document.getElementById('custom-' + key).value = '';
        renderGrid(key + '-grid', PRESETS[key], key);
        update();
    }

    function addLevel() {
        state.levels.push({ name: "New Level", questions: "", answers: "" });
        renderLevels();
    }

    function renderLevels() {
        const container = document.getElementById('levels-list');
        container.innerHTML = state.levels.map((l, i) => `
            <div class="lvl-card">
                <i class="fas fa-trash del-lvl" onclick="state.levels.splice(${i},1);renderLevels();update();"></i>
                <input type="text" value="${l.name}" oninput="state.levels[${i}].name=this.value;update()" style="margin-bottom:10px">
                <div style="display:flex; gap:10px">
                    <div style="flex:1"><label>–í–û–ü–†–û–°–´</label><textarea oninput="state.levels[${i}].questions=this.value;update()">${l.questions}</textarea></div>
                    <div style="flex:1"><label>–û–¢–í–ï–¢–´ (–í–µ—Ä–Ω—ã–π | –ù–µ–≤–µ—Ä–Ω—ã–π)</label><textarea oninput="state.levels[${i}].answers=this.value;update()">${l.answers}</textarea></div>
                </div>
            </div>
        `).join('');
    }

    function setTab(name) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c => c.style.display = 'none');
        document.querySelector(`[onclick="setTab('${name}')"]`).classList.add('active');
        document.getElementById('tab-' + name).style.display = 'block';
    }

    function previewMode(m) { state.mode = m; update(); }

    function update() {
        // Sync Custom Inputs
        ['bg', 'char', 'plat'].forEach(k => {
            const val = document.getElementById('custom-' + k).value;
            if(val) state[k] = val;
        });

        state.neon = document.getElementById('color-neon').value;
        state.fontColor = document.getElementById('color-font').value;
        state.title = document.getElementById('t-title').value;
        state.winT = document.getElementById('t-win').value;
        state.loseT = document.getElementById('t-lose').value;
        state.lives = document.getElementById('g-lives').value;
        state.time = document.getElementById('g-time').value;

        document.getElementById('pre-frame').srcdoc = generateHTML(state);
    }

    function copyCode() {
        const code = generateHTML(state);
        navigator.clipboard.writeText(code).then(() => alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!"));
    }

    function generateHTML(s) {
        const levelsJson = JSON.stringify(s.levels.map(l => ({
            name: l.name,
            qs: l.questions.split('\n').filter(x => x.trim()),
            as: l.answers.split('\n').filter(x => x.trim()).map(x => x.split('|').map(a => a.trim()))
        })));

        return `
<!DOCTYPE html>
<html>
<head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap');
        body { margin:0; overflow:hidden; font-family: 'Montserrat', sans-serif; background: #000; }
        #game { position: relative; width:100vw; height:100vh; background: url('${s.bg}') center/cover; }
        .overlay { position:absolute; inset:0; background:rgba(0,0,0,0.4); display:flex; align-items:center; justify-content:center; z-index:100; }
        
        .card { background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border:2px solid ${s.neon}; border-radius:20px; padding:40px; color:white; text-align:center; box-shadow:0 0 30px ${s.neon}; max-width:80%; }
        .btn-start { background:white; color:black; border:none; padding:15px 40px; border-radius:30px; font-size:24px; font-weight:900; cursor:pointer; margin-top:20px; transition:0.3s; }
        .btn-start:hover { transform:scale(1.1); box-shadow:0 0 20px white; }

        #ui { position:absolute; top:20px; width:100%; display:flex; justify-content:space-between; padding:0 40px; box-sizing:border-box; z-index:10; }
        .stat { background:rgba(0,0,0,0.6); color:white; padding:10px 20px; border-radius:20px; border:1px solid ${s.neon}; font-size:20px; }
        #q-area { position:absolute; top:80px; width:100%; text-align:center; }
        #q-text { background:white; color:${s.fontColor}; display:inline-block; padding:15px 40px; border-radius:15px; font-size:32px; box-shadow: 0 10px 0 #ddd; }
        
        #platforms { position:absolute; bottom:15%; width:100%; display:flex; justify-content:center; gap:30px; }
        .plat { width:150px; height:150px; background:url('${s.plat}') center/contain no-repeat; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:0.2s; }
        .plat:hover { transform:scale(1.1); }
        .ans-text { color:black; font-weight:900; font-size:18px; background:rgba(255,255,255,0.8); padding:5px; border-radius:5px; pointer-events:none; }

        #hero { position:absolute; width:120px; height:120px; background:url('${s.char}') center/contain no-repeat; bottom:15%; left:50px; transition:0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index:5; }
        
        .stars { color:#fbbf24; }
        .hearts { color:#f87171; }
        #timer.warning { color:#f87171; animation: blink 0.5s infinite; }
        @keyframes blink { 50% { opacity:0; } }
    </style>
</head>
<body>
    <div id="game">
        <div id="ui">
            <div class="stat"><span class="stars">‚òÖ</span> <span id="score">0</span></div>
            <div class="stat" id="timer">00:10</div>
            <div class="stat"><span class="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
        </div>

        <div id="q-area"><div id="q-text">–í–æ–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div></div>

        <div id="hero"></div>
        <div id="platforms"></div>

        ${s.mode === 'rules' ? `
        <div class="overlay" id="start-screen">
            <div class="card">
                <img src="${s.char}" width="100">
                <h1 style="font-size:48px; margin:10px 0;">${s.title}</h1>
                <div style="text-align:left; background:rgba(0,0,0,0.3); padding:20px; border-radius:15px;">
                    <h3>How to Play</h3>
                    <ul style="margin:0; padding-left:20px;">
                        <li>Select the correct answer.</li>
                        <li>Watch the timer!</li>
                    </ul>
                </div>
                <button class="btn-start" onclick="startGame()">‚ñ∂ START</button>
            </div>
        </div>` : ''}
        
        <div class="overlay" id="end-screen" style="display:none">
            <div class="card">
                <h1 id="end-title"></h1>
                <h2 id="end-score">Score: 0</h2>
                <button class="btn-start" onclick="location.reload()">RETRY</button>
            </div>
        </div>
    </div>

    <script>
        const config = {
            levels: ${levelsJson},
            lives: ${s.lives},
            timeLimit: ${s.time}
        };

        let curLvl = 0, curQ = 0, score = 0, lives = config.lives, timer, timeLeft;
        const snd_ok = new Audio('https://www.soundjay.com/buttons/sounds/button-37.mp3');
        const snd_no = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3');

        function startGame() {
            if(document.getElementById('start-screen')) document.getElementById('start-screen').style.display = 'none';
            loadQuestion();
        }

        function loadQuestion() {
            const lvl = config.levels[curLvl];
            if(!lvl) return endGame(true);
            if(curQ >= lvl.qs.length) { curLvl++; curQ=0; return loadQuestion(); }

            document.getElementById('q-text').innerText = lvl.qs[curQ];
            const answers = [...lvl.as[curQ]];
            const correctText = answers[0];
            shuffle(answers);

            const pArea = document.getElementById('platforms');
            pArea.innerHTML = '';
            answers.forEach(a => {
                const p = document.createElement('div');
                p.className = 'plat';
                p.innerHTML = '<span class="ans-text">' + a + '</span>';
                p.onclick = () => check(a === correctText, p);
                pArea.appendChild(p);
            });

            resetTimer();
        }

        function check(isCorrect, el) {
            clearInterval(timer);
            if(isCorrect) {
                snd_ok.play();
                score += 10;
                document.getElementById('score').innerText = score;
                const rect = el.getBoundingClientRect();
                const hero = document.getElementById('hero');
                hero.style.left = (rect.left + rect.width/2 - 60) + 'px';
                hero.style.bottom = '30%';
                setTimeout(() => { hero.style.bottom = '15%'; curQ++; loadQuestion(); }, 600);
            } else {
                snd_no.play();
                lives--;
                updateHearts();
                if(lives <= 0) endGame(false);
                else { el.style.opacity = '0.3'; resetTimer(); }
            }
        }

        function resetTimer() {
            clearInterval(timer);
            timeLeft = config.timeLimit;
            const tDisp = document.getElementById('timer');
            tDisp.classList.remove('warning');
            timer = setInterval(() => {
                timeLeft--;
                tDisp.innerText = '00:' + (timeLeft < 10 ? '0' : '') + timeLeft;
                if(timeLeft <= 3) tDisp.classList.add('warning');
                if(timeLeft <= 0) { lives--; updateHearts(); if(lives<=0) endGame(false); else loadQuestion(); }
            }, 1000);
        }

        function updateHearts() {
            document.querySelector('.hearts').innerText = '‚ù§Ô∏è'.repeat(lives);
        }

        function endGame(win) {
            clearInterval(timer);
            const screen = document.getElementById('end-screen');
            screen.style.display = 'flex';
            document.getElementById('end-title').innerText = win ? '${s.winT}' : '${s.loseT}';
            document.getElementById('end-score').innerText = "Final Score: " + score;
        }

        function shuffle(a) { for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} }
        
        if("${s.mode}" === 'game') startGame();
    <\/script>
</body>
</html>`;
    }

    init();
</script>
</body>
</html>
