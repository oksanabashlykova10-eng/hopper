<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Leap & Learn Ultimate Editor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --bg: #111a2e; --panel: #1a253d; --accent: #48e2fe; --text: #e2e8f0; --border: #2d3a5a; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0b0f1a; color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* –°–ò–î–ï–ë–ê–† –ü–û –°–ö–†–ò–ù–®–û–¢–ê–ú */
        aside { width: 420px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .header { padding: 15px; display: flex; align-items: center; gap: 10px; background: var(--bg); color: var(--accent); font-weight: bold; }
        .tabs { display: flex; background: var(--bg); border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 12px 5px; background: none; border: none; color: #707a91; cursor: pointer; font-size: 11px; font-weight: bold; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
        
        .content { flex: 1; overflow-y: auto; padding: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 8px; text-transform: uppercase; }
        input, select, textarea { width: 100%; background: #0f172a; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 6px; box-sizing: border-box; }
        textarea { height: 150px; font-family: monospace; font-size: 12px; }

        .asset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px; }
        .asset-box { border: 2px solid transparent; border-radius: 6px; cursor: pointer; height: 60px; background: #000; overflow: hidden; }
        .asset-box.active { border-color: var(--accent); }
        .asset-box img { width: 100%; height: 100%; object-fit: cover; }

        /* –ü–†–ï–î–ü–†–û–°–ú–û–¢–† */
        main { flex: 1; display: flex; flex-direction: column; background: #0b0f1a; }
        .toolbar { padding: 10px; display: flex; justify-content: center; gap: 15px; background: #0b0f1a; }
        .view-btn { padding: 8px 20px; border-radius: 20px; border: none; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 12px; }
        .btn-rules { background: #5eead4; color: #000; }
        .btn-game { background: #312e81; color: #fff; opacity: 0.5; }
        .btn-game.active { opacity: 1; box-shadow: 0 0 10px #818cf8; }
        iframe { flex: 1; border: none; }

        .lvl-card { background: #111a2e; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border); }
        .btn-copy { width: calc(100% - 40px); margin: 20px; background: #22c55e; color: #fff; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<aside>
    <div class="header"><i class="fas fa-frog"></i> Leap & Learn Editor</div>
    <div class="tabs">
        <button class="tab-btn active" onclick="setTab('visual')">–í–ò–ó–£–ê–õ</button>
        <button class="tab-btn" onclick="setTab('fonts')">–®–†–ò–§–¢–´</button>
        <button class="tab-btn" onclick="setTab('texts')">–¢–ï–ö–°–¢–´</button>
        <button class="tab-btn" onclick="setTab('gameplay')">–ì–ï–ô–ú–ü–õ–ï–ô</button>
        <button class="tab-btn" onclick="setTab('levels')">–£–†–û–í–ù–ò</button>
    </div>

    <div id="tab-visual" class="content">
        <label>–õ–æ–∫–∞—Ü–∏—è (–§–æ–Ω)</label>
        <div class="asset-grid" id="bg-grid"></div>
        <input type="text" id="c-bg" placeholder="–°–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ–Ω..." oninput="update()">
        
        <label style="margin-top:20px">–ü–µ—Ä—Å–æ–Ω–∞–∂</label>
        <div class="asset-grid" id="char-grid"></div>
        <input type="text" id="c-char" placeholder="–°–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–µ—Ä–æ—è..." oninput="update()">

        <label style="margin-top:20px">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
        <div class="asset-grid" id="plat-grid"></div>
        <input type="text" id="c-plat" placeholder="–°–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É..." oninput="update()">
    </div>

    <div id="tab-fonts" class="content" style="display:none">
        <h4 style="color:var(--accent)">? –í–û–ü–†–û–°</h4>
        <div style="display:flex; gap:10px; margin-bottom:15px">
            <div style="flex:1"><label>–¶–≤–µ—Ç</label><input type="color" id="f-q-clr" value="#000000" onchange="update()"></div>
            <div style="flex:1"><label>–†–∞–∑–º–µ—Ä</label><input type="number" id="f-q-size" value="40" oninput="update()"></div>
        </div>
        <label>–®—Ä–∏—Ñ—Ç</label>
        <select id="f-family" onchange="update()">
            <option value="Arial">Arial</option>
            <option value="'Montserrat', sans-serif">Montserrat</option>
        </select>

        <h4 style="color:var(--accent); margin-top:30px">‚òòÔ∏è –û–¢–í–ï–¢–´</h4>
        <div style="display:flex; gap:10px">
            <div style="flex:1"><label>–¶–≤–µ—Ç</label><input type="color" id="f-a-clr" value="#000000" onchange="update()"></div>
            <div style="flex:1"><label>–†–∞–∑–º–µ—Ä</label><input type="number" id="f-a-size" value="18" oninput="update()"></div>
        </div>
    </div>

    <div id="tab-texts" class="content" style="display:none">
        <div class="form-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label><input type="text" id="t-win-h" value="CONGRATULATIONS!" oninput="update()"></div>
        <div class="form-group"><label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label><input type="text" id="t-win-s" value="LEVEL COMPLETE" oninput="update()"></div>
        <div class="form-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü—Ä–æ–∏–≥—Ä—ã—à–∞</label><input type="text" id="t-lose" value="YOU LOST!" oninput="update()"></div>
    </div>

    <div id="tab-levels" class="content" style="display:none">
        <div id="lvl-list"></div>
        <button onclick="addLevel()" style="width:100%; padding:10px; background:#2d3a5a; border:none; color:white; cursor:pointer">+ –î–û–ë–ê–í–ò–¢–¨ –£–†–û–í–ï–ù–¨</button>
    </div>

    <button class="btn-copy" onclick="copyCode()">üìã –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î –î–õ–Ø GENIALLY</button>
</aside>

<main>
    <div class="toolbar">
        <button class="view-btn btn-rules" onclick="setView('rules')">üëÅ –ü—Ä–∞–≤–∏–ª–∞</button>
        <button class="view-btn btn-game" id="g-btn" onclick="setView('game')">üéÆ –ò–≥—Ä–∞</button>
    </div>
    <iframe id="preview"></iframe>
</main>

<script>
    const ASSETS = {
        bg: ['https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png', 'https://img.genially.com/67961b32a116fb001568a75e/fa2ab459-fec9-4ccd-97e3-254427b4ade0.png'],
        char: ['https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png', 'https://img.genially.com/67961b32a116fb001568a75e/74b56fcf-5354-43dd-9c9a-f50facc9a9bf.png'],
        plat: ['https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png', 'https://img.genially.com/67961b32a116fb001568a75e/bad37c6d-f04c-45c0-b954-807d79ec3a95.png']
    };

    let state = {
        bg: ASSETS.bg[0], char: ASSETS.char[0], plat: ASSETS.plat[0],
        view: 'rules',
        font: { family: 'Arial', qClr: '#000000', qSize: 40, aClr: '#000000', aSize: 18 },
        texts: { winH: "CONGRATULATIONS!", winS: "LEVEL COMPLETE", loseH: "YOU LOST!" },
        levels: [{ name: "Level 1", qs: "I ___ a new bike.\nShe ___ got a brother.", as: "have got | has got | is got\nhas | have | is" }]
    };

    function init() {
        ['bg', 'char', 'plat'].forEach(k => renderGrid(k));
        renderLevels();
        update();
    }

    function renderGrid(key) {
        const container = document.getElementById(key + '-grid');
        container.innerHTML = ASSETS[key].map(url => `<div class="asset-box ${state[key] === url ? 'active' : ''}" onclick="selectAsset('${key}', '${url}')"><img src="${url}"></div>`).join('');
    }

    function selectAsset(key, url) { state[key] = url; document.getElementById('c-'+key).value = ''; renderGrid(key); update(); }

    function renderLevels() {
        const list = document.getElementById('lvl-list');
        list.innerHTML = state.levels.map((l, i) => `
            <div class="lvl-card">
                <input type="text" value="${l.name}" oninput="state.levels[${i}].name=this.value;update()" style="margin-bottom:10px; font-weight:bold">
                <div style="display:flex; gap:10px">
                    <div style="flex:1"><label>–í–æ–ø—Ä–æ—Å—ã</label><textarea oninput="state.levels[${i}].qs=this.value;update()">${l.qs}</textarea></div>
                    <div style="flex:1"><label>–û—Ç–≤–µ—Ç—ã</label><textarea oninput="state.levels[${i}].as=this.value;update()">${l.as}</textarea></div>
                </div>
            </div>
        `).join('');
    }

    function addLevel() { state.levels.push({ name: "New Level", qs: "", as: "" }); renderLevels(); }

    function setTab(name) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(name.toLowerCase())));
        document.querySelectorAll('.content').forEach(c => c.style.display = c.id === 'tab-'+name ? 'block' : 'none');
    }

    function setView(v) { state.view = v; document.getElementById('g-btn').classList.toggle('active', v === 'game'); update(); }

    function update() {
        ['bg', 'char', 'plat'].forEach(k => { if(document.getElementById('c-'+k).value) state[k] = document.getElementById('c-'+k).value; });
        state.font = { family: document.getElementById('f-family').value, qClr: document.getElementById('f-q-clr').value, qSize: document.getElementById('f-q-size').value, aClr: document.getElementById('f-a-clr').value, aSize: document.getElementById('f-a-size').value };
        state.texts = { winH: document.getElementById('t-win-h').value, winS: document.getElementById('t-win-s').value, loseH: document.getElementById('t-lose').value };
        document.getElementById('preview').srcdoc = generateGame(state);
    }

    function copyCode() { navigator.clipboard.writeText(generateGame(state, true)).then(() => alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!")); }

    function generateGame(s, forceGame = false) {
        const lvlJson = JSON.stringify(s.levels.map(l => ({
            qs: l.qs.split('\n').filter(t => t.trim()),
            as: l.as.split('\n').filter(t => t.trim()).map(line => line.split('|').map(a => a.trim()))
        })));

        return `
<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin:0; overflow:hidden; font-family: ${s.font.family}; background:#000; }
        #game { position:relative; width:100vw; height:100vh; background:url('${s.bg}') center/cover; }
        .overlay { position:absolute; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:100; color:white; text-align:center; }
        .modal { background:rgba(255,255,255,0.1); backdrop-filter:blur(15px); border:2px solid #48e2fe; border-radius:25px; padding:40px; box-shadow:0 0 30px #48e2fe; }
        
        #q-box { position:absolute; top:50px; width:100%; text-align:center; }
        #q-txt { background:white; color:${s.font.qClr}; font-size:${s.font.qSize}px; padding:15px 40px; border-radius:20px; font-weight:900; box-shadow:0 8px 0 #ccc; }
        
        #hud { position:absolute; top:20px; width:100%; display:flex; justify-content:space-between; padding:0 30px; box-sizing:border-box; }
        .stat { background:rgba(0,0,0,0.5); padding:10px 20px; border-radius:20px; color:white; font-weight:bold; border:1px solid #48e2fe; }

        #hero { position:absolute; bottom:15%; left:5%; width:120px; height:120px; background:url('${s.char}') center/contain no-repeat; transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); z-index:10; }
        
        #plats { position:absolute; bottom:15%; width:100%; display:flex; justify-content:center; gap:30px; }
        .plat { width:150px; height:150px; background:url('${s.plat}') center/contain no-repeat; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:0.2s; }
        .ans-txt { color:${s.font.aClr}; font-size:${s.font.aSize}px; font-weight:bold; background:rgba(255,255,255,0.8); padding:5px 10px; border-radius:5px; }
        
        .btn { background:white; color:black; border:none; padding:15px 40px; border-radius:30px; font-weight:900; cursor:pointer; margin-top:20px; font-size:20px; }
    </style>
</head>
<body>
    <div id="game">
        <div id="hud">
            <div class="stat">‚≠ê <span id="sc">0</span></div>
            <div class="stat" id="tm">00:10</div>
            <div class="stat" id="hp">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        </div>
        <div id="q-box"><div id="q-txt"></div></div>
        <div id="hero"></div>
        <div id="plats"></div>

        <div class="overlay" id="screen-rules" style="display:${s.view === 'rules' && !forceGame ? 'flex' : 'none'}">
            <div class="modal">
                <img src="${s.char}" width="100">
                <h1>Leap & Learn</h1>
                <p>Select the correct answer to jump!</p>
                <button class="btn" onclick="start()">START</button>
            </div>
        </div>

        <div class="overlay" id="screen-win" style="display:none">
            <div class="modal">
                <h1 id="win-h">${s.texts.winH}</h1>
                <h2 id="win-s">${s.texts.winS}</h2>
                <button class="btn" id="next-btn">NEXT LEVEL</button>
            </div>
        </div>
    </div>

    <script>
        const conf = { lvls: ${lvlJson}, hp: 5 };
        let cLvl = 0, cQ = 0, score = 0, hp = conf.hp, timer;
        const sndHop = new Audio('https://www.soundjay.com/button/sounds/button-37.mp3');

        function start() { document.getElementById('screen-rules').style.display='none'; loadQ(); }

        function loadQ() {
            const l = conf.lvls[cLvl];
            if(!l) return finish();
            if(cQ >= l.qs.length) return levelComplete();

            document.getElementById('q-txt').innerText = l.qs[cQ];
            const choices = [...l.as[cQ]];
            const correct = choices[0];
            choices.sort(() => Math.random() - 0.5);

            const pDiv = document.getElementById('plats');
            pDiv.innerHTML = '';
            choices.forEach(text => {
                const p = document.createElement('div');
                p.className = 'plat';
                p.innerHTML = '<span class="ans-txt">'+text+'</span>';
                p.onclick = () => check(text === correct, p);
                pDiv.appendChild(p);
            });
        }

        function check(isOk, el) {
            if(isOk) {
                sndHop.play();
                const rect = el.getBoundingClientRect();
                const hero = document.getElementById('hero');
                hero.style.left = (rect.left + rect.width/2 - 60) + 'px';
                hero.style.bottom = '35%';
                setTimeout(() => { hero.style.bottom = '15%'; score += 10; document.getElementById('sc').innerText = score; cQ++; loadQ(); }, 600);
            } else {
                hp--; document.getElementById('hp').innerText = "‚ù§Ô∏è".repeat(hp);
                if(hp <= 0) alert("${s.texts.loseH}");
            }
        }

        function levelComplete() {
            document.getElementById('screen-win').style.display = 'flex';
            document.getElementById('next-btn').onclick = () => {
                cLvl++; cQ = 0;
                document.getElementById('screen-win').style.display = 'none';
                loadQ();
            };
        }

        function finish() {
            document.getElementById('win-h').innerText = "ALL DONE!";
            document.getElementById('win-s').innerText = "Final Score: " + score;
            document.getElementById('screen-win').style.display = 'flex';
            document.getElementById('next-btn').innerText = "RESTART";
            document.getElementById('next-btn').onclick = () => location.reload();
        }

        if("${s.view}" === 'game') start();
    <\/script>
</body>
</html>`;
    }

    init();
</script>
</body>
</html>
