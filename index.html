<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Leap & Learn Editor - Original Engine</title>
<style>
  :root { --primary: #7cf9ff; --dark: #0a1730; --panel: #142342; --text: #eaf6ff; }
  body { margin:0; display:flex; height:100vh; background: #050b1a; color: var(--text); font-family: sans-serif; overflow:hidden; }
  
  /* EDITOR SIDEBAR */
  #EDITOR { width: 450px; background: var(--dark); border-right: 1px solid #444; display:flex; flex-direction:column; z-index:10; }
  #HEADER { padding:15px; background:var(--panel); border-bottom:1px solid #444; }
  h2 { margin:0; color:var(--primary); font-size:18px; }
  
  #TABS { display:flex; background:#000; }
  .tab { flex:1; padding:10px; text-align:center; cursor:pointer; background:#111; color:#777; border-bottom:3px solid transparent; font-weight:bold; font-size:12px; }
  .tab.active { background:var(--panel); color:var(--primary); border-bottom:3px solid var(--primary); }
  
  #CONTROLS { flex:1; overflow-y:auto; padding:15px; }
  .group { margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:15px; }
  label { display:block; font-size:11px; margin-top:8px; color:#ccc; }
  input, select, textarea { width:100%; box-sizing:border-box; padding:8px; background:#080f20; border:1px solid #444; color:#fff; border-radius:4px; }
  textarea { resize:vertical; font-family:monospace; }
  
  .level-item { background:rgba(255,255,255,0.05); padding:10px; margin-bottom:10px; border-radius:6px; }
  .row { display:flex; gap:10px; } .col { flex:1; }

  button { width:100%; padding:10px; cursor:pointer; background:var(--primary); font-weight:bold; border:none; margin-top:10px; border-radius:4px; }
  button:hover { opacity:0.9; }

  /* PREVIEW */
  #PREVIEW { flex:1; background:#000; position:relative; }
  iframe { width:100%; height:100%; border:none; }
  
  /* COPY MODAL */
  #MODAL { position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:none; align-items:center; justify-content:center; flex-direction:column; }
  #MODAL textarea { width:600px; height:300px; }
</style>
</head>
<body>

<div id="EDITOR">
  <div id="HEADER"><h2>üê∏ Editor: Original Engine</h2></div>
  <div id="TABS">
    <div class="tab active" onclick="setTab('levels')">–£–†–û–í–ù–ò</div>
    <div class="tab" onclick="setTab('visuals')">–í–ò–ó–£–ê–õ</div>
    <div class="tab" onclick="setTab('text')">–¢–ï–ö–°–¢–´</div>
  </div>
  
  <div id="CONTROLS">
    <!-- LEVELS TAB -->
    <div id="tab-levels">
      <div id="levelsList"></div>
      <button onclick="addLevel()" style="background:#333; color:#fff; border:1px dashed #666">+ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
    </div>

    <!-- VISUALS TAB -->
    <div id="tab-visuals" style="display:none">
      <div class="group">
        <h3>–§–æ–Ω –∏ –ü–µ—Ä—Å–æ–Ω–∞–∂</h3>
        <label>–§–æ–Ω (–ö–∞—Ä—Ç–∏–Ω–∫–∞ URL)</label>
        <input type="text" id="bgUrl" value="https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png" oninput="upd()">
        <label>–ü–µ—Ä—Å–æ–Ω–∞–∂ (–ö–∞—Ä—Ç–∏–Ω–∫–∞ URL)</label>
        <input type="text" id="charUrl" value="https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png" oninput="upd()">
        <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (–ö–∞—Ä—Ç–∏–Ω–∫–∞ URL)</label>
        <input type="text" id="platUrl" value="https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png" oninput="upd()">
      </div>
      <div class="group">
        <h3>–¶–≤–µ—Ç–∞</h3>
        <label>–û—Å–Ω–æ–≤–Ω–æ–π –Ω–µ–æ–Ω (#hex)</label>
        <input type="color" id="colNeon" value="#7cf9ff" oninput="upd()">
        <label>–§–æ–Ω —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å)</label>
        <div class="row">
          <input type="color" id="colStart" value="#081022" oninput="upd()">
          <input type="number" id="opStart" value="92" min="0" max="100" title="%" oninput="upd()">
        </div>
      </div>
    </div>

    <!-- TEXT TAB -->
    <div id="tab-text" style="display:none">
      <div class="group">
        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–≥—Ä—ã</label><input id="txtTitle" value="Leap & Learn" oninput="upd()">
        <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label><input id="txtSub" value="Fast quiz game" oninput="upd()">
        <label>–¢–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª (HTML)</label>
        <textarea id="txtRules" rows="4" oninput="upd()"><li>Pick the correct answer.</li><li>Timer difficulty: <span class="kbd">10s ‚Üí 7s ‚Üí 5s</span>.</li><li>Combos increase score!</li></textarea>
      </div>
      <div class="group">
        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label><input id="txtWin" value="CONGRATULATIONS!" oninput="upd()">
        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ—Ä–∞–∂–µ–Ω–∏—è</label><input id="txtLose" value="YOU LOST!" oninput="upd()">
      </div>
    </div>

    <br>
    <button onclick="genCode()" style="padding:15px; font-size:14px;">üìã –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î</button>
  </div>
</div>

<div id="PREVIEW"><iframe id="frame"></iframe></div>

<div id="MODAL">
  <h2 style="color:#fff">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –¥–ª—è Genially:</h2>
  <textarea id="finalCode"></textarea>
  <button onclick="document.getElementById('MODAL').style.display='none'" style="width:200px">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
// Default Data
let levels = [{name:"Level 1", q:"I ____ a new bike.\nShe ____ got a car.", a:"have got | has got | is\nhas | have | is have"}];

// UI Logic
function setTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  event.target.classList.add('active');
  document.querySelectorAll('#CONTROLS > div').forEach(d=>d.style.display='none');
  document.getElementById('tab-'+id).style.display='block';
}

function renderLevels(){
  const c = document.getElementById('levelsList'); c.innerHTML='';
  levels.forEach((l,i)=>{
    const d = document.createElement('div'); d.className='level-item';
    d.innerHTML = `
      <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:5px">
        <span>–£—Ä–æ–≤–µ–Ω—å ${i+1}</span> <span style="color:#f55; cursor:pointer" onclick="delLevel(${i})">‚úñ</span>
      </div>
      <label>–í–æ–ø—Ä–æ—Å—ã (–æ–¥–∏–Ω –≤ —Å—Ç—Ä–æ–∫–µ)</label>
      <textarea rows="3" oninput="levels[${i}].q=this.value;upd()">${l.q}</textarea>
      <label>–û—Ç–≤–µ—Ç—ã (–í–µ—Ä–Ω—ã–π | –ù–µ–≤–µ—Ä–Ω—ã–π | –ù–µ–≤–µ—Ä–Ω—ã–π)</label>
      <textarea rows="3" oninput="levels[${i}].a=this.value;upd()">${l.a}</textarea>
    `;
    c.appendChild(d);
  });
}
function addLevel(){ levels.push({name:"",q:"",a:""}); renderLevels(); upd(); }
function delLevel(i){ if(confirm('–£–¥–∞–ª–∏—Ç—å?')) { levels.splice(i,1); renderLevels(); upd(); } }

// --- THE GENERATOR ---
function getHTML(){
  // Gather vars
  const g = (id) => document.getElementById(id).value;
  
  // Parse Levels to JSON for the engine
  const parsedLevels = levels.map((l, idx) => {
    const qs = l.q.split('\n').filter(x=>x.trim());
    const as = l.a.split('\n').filter(x=>x.trim());
    const questions = qs.map((txt, i) => {
      const ansParts = (as[i] || "Yes|No").split('|');
      return { text: txt, answers: ansParts, correct: 0 }; // Engine randomizes, 0 is always correct in editor
    });
    return { name: "Level " + (idx+1), questions: questions };
  });

  // Calculate overlay color with opacity
  const hex = g('colStart');
  const r=parseInt(hex.slice(1,3),16), gr=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
  const rgba = `rgba(${r},${gr},${b},${g('opStart')/100})`;

  // !!! HERE IS YOUR ORIGINAL ENGINE CODE !!!
  // I only replaced specific values with ${variables}
  
  return `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Leap & Learn</title>
<style>
:root{
  --neon-main:${g('colNeon')};
  --danger:#ff3b3b;
  --win:#ffe44d;
}
html,body{margin:0;width:100%;height:100%;overflow:hidden;font-family:Arial;background:#0a1730}

/* GAME */
#GAME{position:relative;width:100%;height:100%}
#GAME.shake{animation:shake .25s}
@keyframes shake{
  0%{transform:translate(0)} 25%{transform:translate(-4px,3px)} 50%{transform:translate(4px,-3px)} 75%{transform:translate(-3px,2px)} 100%{transform:translate(0)}
}

/* BACKGROUND */
#BG{position:absolute;inset:0;z-index:0;background:url("${g('bgUrl')}") center/cover no-repeat}

/* UI */
#SCORE{position:absolute;top:30px;left:30px;font-size:20px;font-weight:900;z-index:20;color:#fff;text-shadow:0 2px 0 rgba(0,0,0,.35)}

#TIMER{
  position:absolute;top:26px;left:120px;transform:none;
  height:38px;border-radius:18px;
  display:flex;align-items:center;justify-content:center;gap:10px;
  padding:0 14px;
  background:rgba(255,255,255,.95);
  border:2px solid var(--neon-main);
  box-shadow:0 0 18px rgba(124,249,255,.65);
  z-index:20;font-weight:900;color:#053149;
}
#CLOCK_ICON{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;filter:drop-shadow(0 0 10px rgba(124,249,255,.55))}
#TIMER.danger{border-color:var(--danger);color:var(--danger);box-shadow:0 0 25px var(--danger);animation:timerPulse .8s infinite}
@keyframes timerPulse{50%{transform:scale(1.07)}}

#LIVES{position:absolute;top:30px;right:30px;font-size:26px;z-index:20}

/* QUESTION */
#QUESTION{position:absolute;top:18px;width:100%;display:flex;justify-content:center;z-index:20}
#QUESTION_TXT{
  font-size:40px; font-weight:900; color:#0b1630; padding:10px 18px; border-radius:18px;
  background:rgba(255,255,255,.72); border:1px solid rgba(124,249,255,.40);
  box-shadow:0 0 18px rgba(124,249,255,.25), inset 0 0 14px rgba(124,249,255,.10);
  text-shadow:0 2px 0 rgba(0,0,0,.18);
}

/* COMBO UI */
#COMBO{
  position:absolute;top:165px;left:50%;transform:translateX(-50%);
  z-index:20;padding:10px 16px;border-radius:18px;
  background:rgba(255,255,255,.88); border:2px solid var(--neon-main);
  box-shadow:0 0 18px rgba(124,249,255,.65), inset 0 0 14px rgba(124,249,255,.25);
  font-weight:900;color:#043149;display:none;gap:10px;align-items:center;
}
#COMBO.show{display:inline-flex}
#COMBO_BOLT{width:18px;height:18px;border-radius:6px;background:rgba(124,249,255,.25);box-shadow:0 0 14px rgba(124,249,255,.75);display:inline-block}
#COMBO.pulse{animation:comboPulse .55s ease}
@keyframes comboPulse{
  0%{transform:translateX(-50%) translateY(10px) scale(.92); opacity:0}
  40%{transform:translateX(-50%) translateY(0px) scale(1.14); opacity:1}
  100%{transform:translateX(-50%) translateY(0px) scale(1); opacity:1}
}
#COMBO.shine{animation:comboShine .85s ease-in-out infinite}
@keyframes comboShine{
  0%,100%{box-shadow:0 0 22px rgba(124,249,255,.75), inset 0 0 16px rgba(124,249,255,.25)}
  50%{box-shadow:0 0 34px rgba(124,249,255,.95), 0 0 22px rgba(255,228,77,.55), inset 0 0 18px rgba(124,249,255,.35)}
}

/* BUTTONS */
.btn{
  padding:12px 34px;border-radius:16px;font-weight:900;
  background:#fff;border:2px solid var(--neon-main);
  box-shadow:0 0 15px var(--neon-main); cursor:pointer;color:#043149;
}
.btn:active{transform:translateY(1px)}
.btn.dark{background:rgba(255,255,255,.10);color:#eaf6ff;border:2px solid rgba(124,249,255,.55);box-shadow:0 0 16px rgba(124,249,255,.25)}
#START.hide{display:none}

/* START SCREEN */
#START_SCREEN{position:absolute;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;background:${rgba}}
#START_CARD{
  width:min(760px, calc(100vw - 40px)); border-radius:26px;
  background:linear-gradient(180deg, rgba(10,20,50,.92), rgba(5,10,25,.92));
  border:2px solid var(--neon-main); box-shadow:0 0 30px var(--neon-main);
  padding:18px 18px 16px; position:relative;overflow:hidden;color:#eaf6ff;
}
#START_CARD::before{
  content:"";position:absolute;inset:-40%;
  background:radial-gradient(circle at 30% 30%, rgba(124,249,255,.18), transparent 50%), linear-gradient(90deg, transparent, rgba(124,249,255,.14), transparent);
  transform:rotate(10deg); animation:cardGlow 3.2s ease-in-out infinite; pointer-events:none;
}
@keyframes cardGlow{0%,100%{opacity:.55; transform:rotate(10deg) translateX(-10px)} 50%{opacity:1; transform:rotate(10deg) translateX(10px)}}
#START_TOP{position:relative;display:flex;align-items:center;gap:14px;padding:6px 6px 10px}
#START_ICON{width:64px;height:64px;flex:0 0 auto;background:url("${g('charUrl')}") no-repeat center/contain;filter:drop-shadow(0 0 14px var(--neon-main))}
#START_TITLE{font-weight:900;font-size:34px;color:#eaf6ff;text-shadow:0 0 18px var(--neon-main);margin:0;line-height:1.05}
#START_SUB{margin:2px 0 0;color:#bfe9ff;opacity:.9;font-weight:700}
.panel{background:rgba(255,255,255,.08);border:1px solid rgba(124,249,255,.35);border-radius:18px;box-shadow:0 0 12px rgba(124,249,255,.18);padding:12px 12px 10px;margin-top:10px}
.rules{margin:0;color:#cfefff;font-weight:700;line-height:1.35;font-size:14px;padding-left:20px}
.kbd{display:inline-block;padding:2px 8px;border-radius:10px;border:1px solid var(--neon-main);background:rgba(255,255,255,.10);font-weight:900;color:#eaf6ff}
#START_BOTTOM{position:relative;display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px;flex-wrap:wrap}

/* END */
#END{position:absolute;inset:0;z-index:50;background:rgba(8,16,34,.92);display:none;align-items:center;justify-content:center;flex-direction:column}
#END.show{display:flex}
#END_TEXT{font-size:58px;font-weight:900;margin:0 0 10px;animation:sway 2.5s ease-in-out infinite;text-align:center}
.win{color:var(--win);text-shadow:0 0 12px var(--win),0 0 34px var(--win)}
.lose{color:var(--danger);text-shadow:0 0 12px var(--danger),0 0 34px var(--danger)}
@keyframes sway{0%{transform:rotate(0deg)} 25%{transform:rotate(2deg)} 50%{transform:rotate(0deg)} 75%{transform:rotate(-2deg)} 100%{transform:rotate(0deg)}}
#LEVEL_BANNER{margin:0 0 10px;padding:14px 18px;border-radius:20px;background:rgba(255,255,255,.1);border:1px solid var(--win);box-shadow:0 0 24px rgba(255,228,77,.35);color:#fff7cf;font-weight:900;letter-spacing:.06em;text-transform:uppercase;text-align:center}
#LEVEL_NAME{margin:0 0 10px;color:#bfe9ff;font-weight:900}
#HINT_LINE{margin:0 0 16px;color:#cfefff;opacity:.9;font-weight:900;text-align:center}

/* SCORECARD */
#SCORECARD{width:min(620px, calc(100vw - 40px));background:rgba(255,255,255,.10);border:2px solid var(--neon-main);box-shadow:0 0 22px rgba(124,249,255,.45);border-radius:22px;padding:18px 18px 14px;margin:6px 0 16px;position:relative;overflow:hidden;color:#eaf6ff}
#SCOREGRID{position:relative;display:grid;grid-template-columns:1fr 1fr;gap:10px 14px;align-items:stretch}
.row{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.08);border:1px solid rgba(124,249,255,.35);border-radius:16px;padding:12px 14px}
.label{font-size:13px;letter-spacing:.08em;text-transform:uppercase;opacity:.9}
.value{font-size:22px;font-weight:900}
#FINAL_LINE{position:relative;margin-top:12px;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-radius:18px;background:rgba(255,255,255,.10);border:2px solid var(--neon-main)}
#FINAL_SCORE{font-weight:900;font-size:30px}
#END_BTNS{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}

/* FROG & PLATFORMS */
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}
#FROG_WRAP{position:absolute;left:calc(160px - 17mm + 15mm - 11mm);top:calc(50% + 13mm - 11mm);width:110px;height:110px;z-index:15;pointer-events:none;animation:float 3.5s ease-in-out infinite;will-change:transform}
#FROG{width:110px;height:110px;background:url("${g('charUrl')}") no-repeat center/contain;position:absolute; left:50%; top:50%;transform:translate(-50%,-65%);transition:transform .6s ease,opacity .6s ease;pointer-events:none}
#FROG.jump{transform:translate(-50%,-95%) scale(1.05)}
#FROG.sink{transform:translate(-50%,-10%) scale(.6);opacity:0}

#FROG.aura::after{content:"";position:absolute;left:50%; top:52%;width:120px; height:120px;transform:translate(-50%,-50%) scale(1.0);border-radius:50%;background:radial-gradient(circle, rgba(255,228,77,.35), rgba(255,228,77,0) 62%);box-shadow:0 0 18px rgba(255,228,77,0), 0 0 40px rgba(255,228,77,0);filter:drop-shadow(0 0 8px rgba(255,228,77,.65));pointer-events:none;animation:auraPulse .55s ease-in-out 0s 2}
@keyframes auraPulse{0%{transform:translate(-50%,-50%) scale(.96); opacity:.75} 50%{transform:translate(-50%,-50%) scale(1.06); opacity:1} 100%{transform:translate(-50%,-50%) scale(.98); opacity:.9}}

#PLATFORMS{position:absolute;inset:0;z-index:10}
.platform{position:absolute;width:150px;height:150px;transition:transform .5s,opacity .6s}
.lily{
  width:150px;height:150px;background:url("${g('platUrl')}") no-repeat center/contain;
  display:flex;align-items:center;justify-content:center;
  font-weight:900;color:#141414;text-shadow:0 2px 0 rgba(255,255,255,.65), 0 0 10px rgba(0,0,0,.35);
  animation:float 3.5s ease-in-out infinite;transition:transform .5s, filter .2s;cursor:pointer
}
.platform.fade{opacity:0}
.platform.wrong .lily{filter:drop-shadow(0 0 18px red)}
.platform.wobble .lily{animation:float 3.5s ease-in-out infinite, wobble .35s ease-in-out 0s 3}
@keyframes wobble{0%{transform:rotate(0deg)} 25%{transform:rotate(-3deg)} 50%{transform:rotate(3deg)} 75%{transform:rotate(-2deg)} 100%{transform:rotate(0deg)}}

/* FX */
#FX{position:absolute;inset:0;pointer-events:none;z-index:200}
.splash{position:absolute;width:90px;height:34px;background:rgba(255,255,255,.92);border-radius:50%;animation:splash .45s forwards;filter:drop-shadow(0 0 10px rgba(255,255,255,.25))}
@keyframes splash{to{transform:scale(2.2);opacity:0}}
.ripple{position:absolute;border:3px solid rgba(255,255,255,.92);border-radius:50%;animation:ripple 1.45s forwards;filter:drop-shadow(0 0 10px rgba(255,255,255,.15))}
@keyframes ripple{to{transform:scale(2.2);opacity:0}}
.bubble{position:absolute;border-radius:50%;background:rgba(255,255,255,.88);animation:bubble 1.7s forwards;filter:drop-shadow(0 0 10px rgba(255,255,255,.15))}
@keyframes bubble{to{transform:translate(var(--dx),var(--dy));opacity:0}}
.confetti{position:absolute;width:10px;height:14px;border-radius:4px;opacity:.95;animation:confFall 2.25s ease-in forwards;filter:drop-shadow(0 0 12px var(--neon-main))}
@keyframes confFall{0%{transform:translate3d(0,0,0) rotate(0deg);opacity:1} 100%{transform:translate3d(var(--dx), calc(100vh + 140px), 0) rotate(720deg);opacity:0}}
.spark{position:absolute;width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.95);box-shadow:0 0 22px var(--neon-main);animation:spark 760ms ease-out forwards}
@keyframes spark{0%{transform:translate(0,0) scale(1);opacity:1} 100%{transform:translate(var(--dx),var(--dy)) scale(.25);opacity:0}}
.goldSpark{position:absolute;width:6px;height:6px;border-radius:50%;background:rgba(255,228,77,.98);box-shadow:0 0 18px rgba(255,228,77,.95);animation:goldSpark 820ms ease-out forwards}
@keyframes goldSpark{0%{transform:translate(0,0) scale(1);opacity:1} 100%{transform:translate(var(--dx),var(--dy)) scale(.2);opacity:0}}
</style>
</head>
<body>
<div id="GAME">
  <div id="BG"></div>
  <div id="SCORE">‚≠ê 0</div>
  <div id="TIMER"><span id="CLOCK_ICON">‚è±Ô∏è</span><span id="TIMER_TXT">00:10</span></div>
  <div id="QUESTION"><span id="QUESTION_TXT"></span></div>
  <div id="COMBO"><span id="COMBO_BOLT"></span><span id="COMBO_TXT">COMBO x1.0</span></div>
  <div id="LIVES"></div>
  <div id="START" class="btn hide">‚ñ∂ Start</div>

  <div id="START_SCREEN">
    <div id="START_CARD">
      <div id="START_TOP"><div id="START_ICON"></div><div><h1 id="START_TITLE">${g('txtTitle')}</h1><div id="START_SUB">${g('txtSub')}</div></div></div>
      <div class="panel"><h3>How to Play</h3><ul class="rules">${g('txtRules')}</ul></div>
      <div id="START_BOTTOM"><button id="START_BTN" class="btn">${g('btnStartTxt')}</button></div>
    </div>
  </div>

  <div id="END">
    <div id="END_TEXT"></div><div id="LEVEL_BANNER">LEVEL COMPLETE</div><div id="LEVEL_NAME">Level 1</div><div id="HINT_LINE"></div>
    <div id="SCORECARD"><div id="SCOREGRID">
        <div class="row"><div class="label">Questions</div><div id="STAT_Q" class="value">0/0</div></div>
        <div class="row"><div class="label">Lives</div><div id="STAT_L" class="value">‚ù§Ô∏è0</div></div>
        <div class="row"><div class="label">Base</div><div id="STAT_B" class="value">‚≠ê 0</div></div>
        <div class="row"><div class="label">Time Bonus</div><div id="STAT_T" class="value">‚≠ê 0</div></div>
        <div class="row"><div class="label">Combo Bonus</div><div id="STAT_C" class="value">‚≠ê 0</div></div>
        <div class="row"><div class="label">Penalties</div><div id="STAT_P" class="value">‚≠ê 0</div></div>
      </div>
      <div id="FINAL_LINE"><div id="FINAL_LABEL">Total Score</div><div id="FINAL_SCORE">‚≠ê Score: 0</div></div>
    </div>
    <div id="END_BTNS"><button id="NEXT_LEVEL" class="btn">‚è≠ Next Level</button><button id="FINISH" class="btn dark">üèÅ Finish</button><button id="RETRY" class="btn">üîÅ Play again</button></div>
  </div>

  <div id="FX"></div>
  <div id="FROG_WRAP"><div id="FROG"></div></div>
  <div id="PLATFORMS"></div>
</div>

<script>
// --- YOUR ORIGINAL ENGINE START ---
const LEVELS=${JSON.stringify(parsedLevels)};
const BASE=100; const MULT=10; const WRONG_PENALTY=80; const LIVES_START=5;
const Q_TXT=document.getElementById("QUESTION_TXT"); const T=document.getElementById("TIMER"); const T_TXT=document.getElementById("TIMER_TXT"); const L=LIVES, S=SCORE, P=PLATFORMS; const FX=document.getElementById("FX"); const GAME=document.getElementById("GAME"); const FROG=document.getElementById("FROG");
const START_SCREEN=document.getElementById("START_SCREEN"); const START_BTN=document.getElementById("START_BTN");
const COMBO_UI=document.getElementById("COMBO"); const COMBO_TXT=document.getElementById("COMBO_TXT");
const END=document.getElementById("END"); const END_TEXT=document.getElementById("END_TEXT"); const FINAL_SCORE=document.getElementById("FINAL_SCORE"); const RETRY=document.getElementById("RETRY"); const FINISH=document.getElementById("FINISH"); const NEXT_LEVEL=document.getElementById("NEXT_LEVEL"); const LEVEL_BANNER=document.getElementById("LEVEL_BANNER"); const LEVEL_NAME=document.getElementById("LEVEL_NAME"); const HINT_LINE=document.getElementById("HINT_LINE");
const STAT_Q=document.getElementById("STAT_Q"); const STAT_L=document.getElementById("STAT_L"); const STAT_B=document.getElementById("STAT_B"); const STAT_T=document.getElementById("STAT_T"); const STAT_C=document.getElementById("STAT_C"); const STAT_P=document.getElementById("STAT_P");

let QUESTIONS=[]; let q=0, lives=LIVES_START, score=0, started=false, locked=false; let timer=null, timeLeft=0;
let baseSum=0, timeBonusSum=0, comboBonusSum=0, penaltySum=0; let correctCount=0, combo=0, maxCombo=0;
let levelIndex=0; let campaignMode=false; let campaignCompleted=false; let finishStage=0;
let grandScore=0, grandBase=0, grandTime=0, grandCombo=0, grandPenalty=0; let grandDone=0, grandTotal=0;

const ctx=new (AudioContext||webkitAudioContext)();

function okSound(){
  const t=ctx.currentTime;
  [523,659,784].forEach((f,i)=>{const o=ctx.createOscillator(),g=ctx.createGain();o.frequency.value=f;g.gain.setValueAtTime(0,t+i*.12);g.gain.linearRampToValueAtTime(.25,t+i*.12+.05);g.gain.exponentialRampToValueAtTime(.001,t+i*.12+.4);o.connect(g);g.connect(ctx.destination);o.start(t+i*.12);o.stop(t+i*.12+.45);});
}
function tickSound(){
  const t=ctx.currentTime; const o=ctx.createOscillator(), g=ctx.createGain(); o.type="square"; o.frequency.setValueAtTime(1800, t); g.gain.setValueAtTime(0.0001, t); g.gain.linearRampToValueAtTime(0.12, t+0.01); g.gain.exponentialRampToValueAtTime(0.0001, t+0.08); o.connect(g); g.connect(ctx.destination); o.start(t); o.stop(t+0.09);
}
function comboJoySound(){
  const t=ctx.currentTime; const master=ctx.createGain(); master.gain.setValueAtTime(0.0001,t); master.gain.linearRampToValueAtTime(0.35,t+0.02); master.gain.exponentialRampToValueAtTime(0.0001,t+0.35); master.connect(ctx.destination);
  const notes=[880,1175,1568]; notes.forEach((f,i)=>{const o=ctx.createOscillator(), g=ctx.createGain(); o.type="triangle"; o.frequency.setValueAtTime(f,t+i*0.06); g.gain.setValueAtTime(0.0001,t+i*0.06); g.gain.linearRampToValueAtTime(0.22,t+i*0.06+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t+i*0.06+0.20); o.connect(g); g.connect(master); o.start(t+i*0.06); o.stop(t+i*0.06+0.22);});
}
function turboSound(intensity=1){
  const t=ctx.currentTime; const master=ctx.createGain(); master.gain.setValueAtTime(0.0001,t); master.gain.linearRampToValueAtTime(0.22*intensity,t+0.02); master.gain.exponentialRampToValueAtTime(0.0001,t+0.28); master.connect(ctx.destination);
  const buf=ctx.createBuffer(1, ctx.sampleRate*0.25, ctx.sampleRate); const data=buf.getChannelData(0); for(let i=0;i<data.length;i++) data[i]=(Math.random()*2-1)*(1-i/data.length);
  const src=ctx.createBufferSource(); src.buffer=buf; const bp=ctx.createBiquadFilter(); bp.type="bandpass"; bp.Q.value=0.9; bp.frequency.setValueAtTime(300,t); bp.frequency.exponentialRampToValueAtTime(1800,t+0.22); src.connect(bp); bp.connect(master); src.start(t);
}
function cameraKick(strength=1){
  const dx = 2.2*strength; const dy = -1.2*strength;
  try{GAME.animate([{ transform:"translate(0,0)" }, { transform:\`translate(\${dx}px,\${dy}px)\` }, { transform:"translate(0,0)" }], { duration:140, easing:"ease-out" });}catch(e){}
}
function loseFinalSound(){
  const o=ctx.createOscillator(),g=ctx.createGain(); o.type="sawtooth"; o.frequency.setValueAtTime(220,ctx.currentTime); o.frequency.exponentialRampToValueAtTime(70,ctx.currentTime+1.4); g.gain.setValueAtTime(.4,ctx.currentTime); g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+1.4); o.connect(g);g.connect(ctx.destination); o.start();o.stop(ctx.currentTime+1.5);
}
function waterFailSound(){
  const b=ctx.createBuffer(1,ctx.sampleRate*.9,ctx.sampleRate); const d=b.getChannelData(0); for(let i=0;i<d.length;i++)d[i]=(Math.random()*2-1)*(1-i/d.length);
  const s=ctx.createBufferSource(),g=ctx.createGain(); g.gain.value=.6; s.buffer=b; s.connect(g);g.connect(ctx.destination); s.start();
}
function fanfareSound(strength=1){
  const t=ctx.currentTime; const master=ctx.createGain(); master.gain.setValueAtTime(0.0,t); master.gain.linearRampToValueAtTime(0.95*strength,t+0.05); master.gain.exponentialRampToValueAtTime(0.001,t+2.8); master.connect(ctx.destination);
  function tone(freq, start, dur, type="sawtooth", gain=0.34){ const o=ctx.createOscillator(), g=ctx.createGain(); o.type=type; o.frequency.value=freq; g.gain.setValueAtTime(0, t+start); g.gain.linearRampToValueAtTime(gain*strength, t+start+0.03); g.gain.exponentialRampToValueAtTime(0.001, t+start+dur); o.connect(g); g.connect(master); o.start(t+start); o.stop(t+start+dur+0.02);}
  const C5=523.25, E5=659.25, G5=783.99, C6=1046.5, E6=1318.5; [C5,E5,G5].forEach(f=>tone(f,0.00,0.70,"sawtooth",0.30)); [E5,G5,C6].forEach(f=>tone(f,0.55,0.80,"sawtooth",0.28)); [G5,C6,E6].forEach(f=>tone(f,1.15,1.05,"sawtooth",0.25)); const arp=[C5,E5,G5,C6,E5,G5,C6,E6]; arp.forEach((f,i)=>tone(f,0.15+i*0.10,0.22,"triangle",0.20));
}
function playWinSound(){ fanfareSound(1.0); }
function playTotalSound(){ fanfareSound(1.25); }

function waterFX(bubbles=false){
  const x=160, y=innerHeight/2+64;
  const s=document.createElement("div"); s.className="splash"; s.style.left=(x-45)+"px"; s.style.top=(y-17)+"px"; FX.appendChild(s); setTimeout(()=>s.remove(),520);
  for(let i=0;i<3;i++){const r=document.createElement("div"); r.className="ripple"; const size=64+i*40; r.style.width=r.style.height=size+"px"; r.style.left=(x-size/2)+"px"; r.style.top=(y-size/2)+"px"; FX.appendChild(r); setTimeout(()=>r.remove(),1550);}
  if(bubbles){for(let i=0;i<20;i++){const b=document.createElement("div"); b.className="bubble"; const ss=6+Math.random()*12; b.style.width=b.style.height=ss+"px"; b.style.left=(x + Math.random()*140 - 70)+"px"; b.style.top=(y + Math.random()*34 - 17)+"px"; b.style.setProperty("--dx",(Math.random()*140-70)+"px"); b.style.setProperty("--dy",(-140-Math.random()*120)+"px"); FX.appendChild(b); setTimeout(()=>b.remove(),1750);}}
}
function confettiBurst(power=1){
  const count=Math.floor(180*power); for(let i=0;i<count;i++){const c=document.createElement("div"); c.className="confetti"; const x=Math.random()*innerWidth; c.style.left=x+"px"; c.style.top=(-30 - Math.random()*200)+"px"; c.style.setProperty("--dx",(Math.random()*420-210)+"px"); c.style.background = \`hsla(\${Math.random()*360}, 98%, 62%, .99)\`; FX.appendChild(c); setTimeout(()=>c.remove(),2700);}
}
function sparkBurst(cx,cy, power=1){
  const n=Math.floor(64*power); for(let i=0;i<n;i++){const sp=document.createElement("div"); sp.className="spark"; sp.style.left=(cx-4)+"px"; sp.style.top=(cy-4)+"px"; sp.style.setProperty("--dx",(Math.random()*520-260)+"px"); sp.style.setProperty("--dy",(Math.random()*-360-40)+"px"); sp.style.background = \`hsla(\${Math.random()*360}, 98%, 72%, .99)\`; sp.style.boxShadow = \`0 0 28px hsla(\${Math.random()*360}, 98%, 72%, .98)\`; FX.appendChild(sp); setTimeout(()=>sp.remove(),1100);}
}
function comboEnergyFX(strength=1){
  const r = FROG.getBoundingClientRect(); const cx = r.left + r.width*0.50; const cy = r.top  + r.height*0.56;
  const count = Math.floor(14 + strength*10); for(let i=0;i<count;i++){const p=document.createElement("div"); p.className="goldSpark"; p.style.left=(cx + (Math.random()*40-20))+"px"; p.style.top =(cy + (Math.random()*36-18))+"px"; const dx = (Math.random()*220-110) * (0.45 + strength*0.15); const dy = (Math.random()*-180-30) * (0.55 + strength*0.12); p.style.setProperty("--dx", dx+"px"); p.style.setProperty("--dy", dy+"px"); FX.appendChild(p); setTimeout(()=>p.remove(), 900);}
}
function showComboAura(){
  const c = combo; const strength = Math.min(1.0, 0.45 + c*0.12); const dur = Math.min(1000, 600 + c*80);
  const blur1 = Math.min(46, 18 + c*6); const blur2 = Math.min(92, 40 + c*10); const scale = Math.min(1.35, 1.02 + c*0.04); const opacity = Math.min(0.95, 0.55 + c*0.08);
  FROG.style.setProperty("--auraBlur1", blur1+"px"); FROG.style.setProperty("--auraBlur2", blur2+"px"); FROG.style.setProperty("--auraScale",  scale.toFixed(2)); FROG.style.setProperty("--auraOpacity", opacity.toFixed(2));
  FROG.classList.remove("aura"); void FROG.offsetWidth; FROG.classList.add("aura"); setTimeout(()=>FROG.classList.remove("aura"), dur);
  comboEnergyFX(strength); turboSound(0.75 + strength*0.55); cameraKick(0.55 + strength*0.35);
}
function frogJump(){FROG.classList.add("jump");setTimeout(()=>FROG.classList.remove("jump"),300)}
function cameraShake(){GAME.classList.add("shake");setTimeout(()=>GAME.classList.remove("shake"),300)}
function fmt(s){ return "00:"+String(s).padStart(2,"0"); }
function shuffle(arr){const a=arr.slice(); for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a;}
function randomizeQuestion(qObj){const packs = qObj.answers.map((txt,idx)=>({txt, idx})); const shuffled = shuffle(packs); const newAnswers = shuffled.map(x=>x.txt); const newCorrect = shuffled.findIndex(x=>x.idx===qObj.correct); return { text:qObj.text, answers:newAnswers, correct:newCorrect };}
function totalQuestionsInAllLevels(){return LEVELS.reduce((s,l)=>s+(l.questions?.length||0),0);}
function getRoundTime(){const d={t1:10,t2:7,t3:5}; if(correctCount<3) return d.t1; if(correctCount<6) return d.t2; return d.t3;}
function comboMultiplier(){const m = 1 + combo*0.12; return Math.min(2.0, Math.round(m*10)/10);}
function updateComboUI(){if(combo<=0){COMBO_UI.classList.remove("show","pulse","shine"); return;} COMBO_UI.classList.add("show","pulse","shine"); setTimeout(()=>COMBO_UI.classList.remove("pulse"), 560); COMBO_TXT.textContent = \`COMBO x\${comboMultiplier().toFixed(1)}\`;}
function startTimer(){clearInterval(timer); timeLeft=getRoundTime(); T.classList.remove("danger"); T_TXT.textContent=fmt(timeLeft); timer=setInterval(()=>{timeLeft--; if(timeLeft<=0){ clearInterval(timer); fail("time"); return; } T_TXT.textContent=fmt(timeLeft); if(timeLeft<=3){ T.classList.add("danger"); tickSound(); } else T.classList.remove("danger");},1000);}
function buildQuestionsForLevel(idx){const lvl = LEVELS[idx] || LEVELS[0]; const randomized = (lvl.questions||[]).map(q=>randomizeQuestion(q)); QUESTIONS = shuffle(randomized);}
function render(){locked=!started; P.innerHTML=""; FROG.classList.remove("sink"); Q_TXT.textContent=QUESTIONS[q]?.text || ""; L.textContent="‚ù§Ô∏è".repeat(lives); S.textContent="‚≠ê "+score; updateComboUI(); const STEP=190, y=innerHeight/2 + 76; const count=Math.ceil((innerWidth-160)/STEP)+4; for(let i=0;i<count;i++){const d=document.createElement("div"); d.className="platform"; d.style.left=160+STEP*i-75+"px"; d.style.top=y-75+"px"; const lily=document.createElement("div"); lily.className="lily"; if(i>0 && QUESTIONS[q] && i<=QUESTIONS[q].answers.length){lily.textContent=QUESTIONS[q].answers[i-1]; d.classList.add("answer"); d.onclick=()=>pick(i,d);} d.appendChild(lily); P.appendChild(d);}}
function pick(i,el){if(!started||locked) return; locked=true; clearInterval(timer); frogJump(); document.querySelectorAll(".platform").forEach(p=>p.style.transform=\`translateX(\${-(el.offsetLeft+75-160)}px)\`); setTimeout(()=>{const isCorrect = (i-1===QUESTIONS[q].correct); if(isCorrect){okSound(); waterFX(false); const basePts = BASE; const timePts = timeLeft*MULT; baseSum += basePts; timeBonusSum += timePts; combo++; maxCombo = Math.max(maxCombo, combo); const mult = comboMultiplier(); const comboBonus = Math.round((basePts + timePts) * (mult-1)); comboBonusSum += comboBonus; score += basePts + timePts + comboBonus; correctCount++; if(combo>=2){comboJoySound(); showComboAura();} sparkBurst(innerWidth/2, innerHeight*0.35, 0.9); q++; if(q>=QUESTIONS.length) showEnd(true); else startRound();}else{fail("wrong");}},500);}
function fail(reason){lives--; if(combo>0) combo=0; updateComboUI(); const penalty = WRONG_PENALTY; penaltySum += penalty; score = Math.max(0, score - penalty); FROG.classList.remove("aura"); waterFailSound(); waterFX(true); cameraShake(); FROG.classList.add("sink"); document.querySelectorAll(".platform").forEach(p=>{p.classList.add("fade","wrong","wobble"); setTimeout(()=>p.classList.remove("wobble"), 900);}); setTimeout(()=>{ lives<=0 ? showEnd(false) : startRound(); },900);}
function startRound(){locked=false; render(); startTimer();}
function fillLevelTable(){const done = Math.min(q, QUESTIONS.length); STAT_Q.textContent = \`\${done}/\${QUESTIONS.length}\`; STAT_L.textContent = "‚ù§Ô∏è" + lives; STAT_B.textContent = "‚≠ê " + baseSum; STAT_T.textContent = "‚≠ê " + timeBonusSum; STAT_C.textContent = "‚≠ê " + comboBonusSum; STAT_P.textContent = "‚≠ê " + penaltySum; FINAL_SCORE.textContent="‚≠ê Score: "+score;}
function pushLevelToGrand(){grandScore += score; grandBase  += baseSum; grandTime  += timeBonusSum; grandCombo += comboBonusSum; grandPenalty += penaltySum; grandDone += Math.min(q, QUESTIONS.length);}
function showTotalResults(){LEVEL_BANNER.textContent = "TOTAL RESULTS"; LEVEL_NAME.textContent = "Game Completed"; HINT_LINE.textContent = ""; END_TEXT.textContent = "GAME COMPLETED!"; END_TEXT.className = "win"; STAT_Q.textContent = \`\${grandDone}/\${grandTotal}\`; STAT_L.textContent = "‚ù§Ô∏è" + lives; STAT_B.textContent = "‚≠ê " + grandBase; STAT_T.textContent = "‚≠ê " + grandTime; STAT_C.textContent = "‚≠ê " + grandCombo; STAT_P.textContent = "‚≠ê " + grandPenalty; FINAL_SCORE.textContent = "‚≠ê Score: " + grandScore; NEXT_LEVEL.style.display="none"; FINISH.textContent = "üè† Back to Menu"; playTotalSound(); confettiBurst(1.8); sparkBurst(innerWidth/2, innerHeight*0.22, 1.7); setTimeout(()=>confettiBurst(1.4), 220); setTimeout(()=>sparkBurst(innerWidth/2, innerHeight*0.30, 1.8), 340); setTimeout(()=>sparkBurst(innerWidth/2, innerHeight*0.38, 1.4), 560);}
function showEnd(win){clearInterval(timer); END.classList.add("show"); const lvlName = (LEVELS[levelIndex]?.name) || \`Level \${levelIndex+1}\`; LEVEL_NAME.textContent = campaignMode ? \`\${lvlName} (Campaign)\` : lvlName; finishStage=0; FINISH.textContent="üèÅ Finish"; const last = (levelIndex >= LEVELS.length-1); if(win){END_TEXT.textContent="${g('txtWin')}"; END_TEXT.className="win"; LEVEL_BANNER.textContent="LEVEL COMPLETE"; playWinSound(); confettiBurst(1.2); sparkBurst(innerWidth/2, innerHeight*0.22, 1.2); setTimeout(()=>confettiBurst(1.0), 220); setTimeout(()=>sparkBurst(innerWidth/2, innerHeight*0.35, 1.1), 420); if(campaignMode && last){campaignCompleted=true; HINT_LINE.textContent = "All levels cleared ‚Äî press Finish to see Total Results"; NEXT_LEVEL.style.display="none";}else{campaignCompleted=false; HINT_LINE.textContent = ""; NEXT_LEVEL.style.display = (last ? "none" : "inline-block");}}else{END_TEXT.textContent="${g('txtLose')}"; END_TEXT.className="lose"; LEVEL_BANNER.textContent="TRY AGAIN"; HINT_LINE.textContent=""; campaignCompleted=false; NEXT_LEVEL.style.display="none"; loseFinalSound();} fillLevelTable();}
function resetState(){q=0; lives=LIVES_START; score=0; started=false; locked=false; baseSum=0; timeBonusSum=0; comboBonusSum=0; penaltySum=0; correctCount=0; combo=0; maxCombo=0; clearInterval(timer); END.classList.remove("show"); END_TEXT.className=""; COMBO_UI.classList.remove("show","pulse","shine"); T.classList.remove("danger"); FROG.classList.remove("aura"); finishStage=0; campaignCompleted=false; HINT_LINE.textContent=""; FINISH.textContent="üèÅ Finish"; T_TXT.textContent=fmt(getRoundTime());}
function startLevel(idx){levelIndex = Math.max(0, Math.min(LEVELS.length-1, idx)); buildQuestionsForLevel(levelIndex); resetState(); START_SCREEN.style.display="none"; started=true; render(); startRound();}
function startCampaign(){campaignMode=true; levelIndex=0; grandScore=0; grandBase=0; grandTime=0; grandCombo=0; grandPenalty=0; grandDone=0; grandTotal = totalQuestionsInAllLevels(); startLevel(0);}
START_BTN.onclick=()=>{ctx.resume(); startCampaign();};
RETRY.onclick=()=>{resetState(); campaignMode=false; START_SCREEN.style.display="flex"; render();};
NEXT_LEVEL.onclick=()=>{ctx.resume(); if(campaignMode) pushLevelToGrand(); const next = levelIndex+1; if(next >= LEVELS.length) return; startLevel(next);};
FINISH.onclick=()=>{ctx.resume(); if(campaignMode && campaignCompleted && finishStage===0){pushLevelToGrand(); finishStage=1; showTotalResults(); return;} resetState(); campaignMode=false; START_SCREEN.style.display="flex"; render();};
window.addEventListener("resize", ()=>{if(started && !END.classList.contains("show")) render();});
T_TXT.textContent = fmt(getRoundTime()); render();
// --- ORIGINAL ENGINE END ---
<` + `/script>
</body>
</html>`;
}

function upd() {
  document.getElementById('frame').srcdoc = getHTML();
}
function genCode() {
  document.getElementById('finalCode').value = `<iframe style="width:100%;height:100%;border:0" srcdoc='${getHTML().replace(/'/g, "&#39;")}'></iframe>`;
  document.getElementById('MODAL').style.display = 'flex';
}

// Init
renderLevels();
upd();
</script>
</body>
</html>
