<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Leap & Learn Editor - Professional</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #111a2e;
            --panel-bg: #1a253d;
            --sidebar-w: 420px;
            --accent: #48e2fe;
            --text-main: #e2e8f0;
            --border: #2d3a5a;
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0b0f1a; color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR STYLE FROM SCREEN 1 */
        aside { width: var(--sidebar-w); background: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .editor-header { padding: 15px; display: flex; align-items: center; gap: 10px; background: #111a2e; }
        .editor-header h2 { font-size: 18px; margin: 0; color: var(--accent); letter-spacing: 1px; }

        .tabs { display: flex; background: #111a2e; }
        .tab-btn { flex: 1; padding: 12px 5px; background: none; border: none; color: #707a91; cursor: pointer; font-size: 11px; font-weight: bold; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); background: rgba(72, 226, 254, 0.05); }

        .content { flex: 1; overflow-y: auto; padding: 20px; }
        .section-title { font-size: 12px; font-weight: bold; color: var(--accent); text-transform: uppercase; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }

        /* FORM ELEMENTS */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 8px; }
        input, select, textarea { width: 100%; background: #0f172a; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 6px; font-size: 14px; }
        textarea { height: 100px; font-family: monospace; resize: none; }
        
        .asset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 10px; }
        .asset-box { border: 2px solid transparent; border-radius: 6px; cursor: pointer; height: 60px; background: #000; overflow: hidden; transition: 0.2s; }
        .asset-box.active { border-color: var(--accent); box-shadow: 0 0 10px var(--accent); }
        .asset-box img { width: 100%; height: 100%; object-fit: cover; }

        /* PREVIEW AREA */
        main { flex: 1; display: flex; flex-direction: column; background: #0f172a; }
        .preview-toolbar { padding: 10px; background: #0b0f1a; display: flex; justify-content: center; gap: 15px; border-bottom: 1px solid var(--border); }
        .view-toggle { padding: 8px 20px; border-radius: 20px; border: none; cursor: pointer; font-size: 12px; font-weight: bold; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        .btn-rules { background: #5eead4; color: #000; }
        .btn-game { background: #312e81; color: #fff; opacity: 0.6; }
        .btn-game.active { opacity: 1; box-shadow: 0 0 10px #818cf8; }

        iframe { flex: 1; border: none; }

        .lvl-container { background: #111a2e; border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .lvl-head { display: flex; justify-content: space-between; margin-bottom: 10px; }
        
        .footer { padding: 20px; background: #111a2e; border-top: 1px solid var(--border); }
        .btn-copy { width: 100%; background: #22c55e; color: #fff; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
    </style>
</head>
<body>

<aside>
    <div class="editor-header">
        <i class="fas fa-frog"></i>
        <h2>Leap & Learn Editor</h2>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="setTab('visual')">–í–ò–ó–£–ê–õ</button>
        <button class="tab-btn" onclick="setTab('fonts')">–®–†–ò–§–¢–´</button>
        <button class="tab-btn" onclick="setTab('texts')">–¢–ï–ö–°–¢–´</button>
        <button class="tab-btn" onclick="setTab('gameplay')">–ì–ï–ô–ú–ü–õ–ï–ô</button>
        <button class="tab-btn" onclick="setTab('levels')">–£–†–û–í–ù–ò</button>
    </div>

    <div id="tab-visual" class="content">
        <div class="section-title">–õ–æ–∫–∞—Ü–∏—è (–§–æ–Ω)</div>
        <div class="asset-grid" id="bg-grid"></div>
        <input type="text" id="c-bg" placeholder="–ò–ª–∏ —Å–≤–æ—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É..." oninput="update()">

        <div class="section-title" style="margin-top:20px">–ü–µ—Ä—Å–æ–Ω–∞–∂</div>
        <div class="asset-grid" id="char-grid"></div>
        <input type="text" id="c-char" placeholder="–°–≤–æ–π URL –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" oninput="update()">

        <div class="section-title" style="margin-top:20px">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</div>
        <div class="asset-grid" id="plat-grid"></div>
        <input type="text" id="c-plat" placeholder="–°–≤–æ–π URL –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã" oninput="update()">
        
        <div class="section-title" style="margin-top:20px">–¶–≤–µ—Ç–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
        <label>–û—Å–Ω–æ–≤–Ω–æ–π –Ω–µ–æ–Ω</label>
        <input type="color" id="clr-neon" value="#48e2fe" onchange="update()">
    </div>

    <div id="tab-fonts" class="content" style="display:none">
        <div class="section-title"><i class="fas fa-question-circle"></i> –í–û–ü–†–û–°</div>
        <div style="display:flex; gap:10px; margin-bottom:15px">
            <div style="flex:2"><label>–¶–≤–µ—Ç</label><input type="color" id="f-q-clr" value="#000000" onchange="update()"></div>
            <div style="flex:1"><label>–†–∞–∑–º–µ—Ä</label><input type="number" id="f-q-size" value="40" oninput="update()"></div>
        </div>
        <label>–®—Ä–∏—Ñ—Ç</label>
        <select id="f-family" onchange="update()">
            <option value="Arial">Arial</option>
            <option value="'Montserrat', sans-serif">Montserrat</option>
            <option value="'Courier New', monospace">Courier New</option>
        </select>

        <div class="section-title" style="margin-top:30px"><i class="fas fa-clover"></i> –û–¢–í–ï–¢–´</div>
        <div style="display:flex; gap:10px">
            <div style="flex:2"><label>–¶–≤–µ—Ç</label><input type="color" id="f-a-clr" value="#000000" onchange="update()"></div>
            <div style="flex:1"><label>–†–∞–∑–º–µ—Ä</label><input type="number" id="f-a-size" value="18" oninput="update()"></div>
        </div>
    </div>

    <div id="tab-texts" class="content" style="display:none">
        <div class="form-group">
            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label>
            <input type="text" id="txt-win-h" value="CONGRATULATIONS!" oninput="update()">
        </div>
        <div class="form-group">
            <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label>
            <input type="text" id="txt-win-s" value="LEVEL COMPLETE" oninput="update()">
        </div>
        <div class="form-group">
            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ü—Ä–æ–∏–≥—Ä—ã—à–∞</label>
            <input type="text" id="txt-lose-h" value="YOU LOST!" oninput="update()">
        </div>
    </div>

    <div id="tab-gameplay" class="content" style="display:none">
        <div class="form-group"><label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π</label><input type="number" id="g-lives" value="5" oninput="update()"></div>
        <div class="form-group"><label>–¢–∞–π–º–µ—Ä –Ω–∞ –≤–æ–ø—Ä–æ—Å (—Å–µ–∫)</label><input type="number" id="g-time" value="10" oninput="update()"></div>
    </div>

    <div id="tab-levels" class="content" style="display:none">
        <div id="levels-list"></div>
        <button onclick="addLevel()" style="width:100%; padding:10px; background:#2d3a5a; border:none; color:white; cursor:pointer">+ –î–û–ë–ê–í–ò–¢–¨ –£–†–û–í–ï–ù–¨</button>
    </div>

    <div class="footer">
        <button class="btn-copy" onclick="copyResult()">üìù –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î –î–õ–Ø GENIALLY</button>
    </div>
</aside>

<main>
    <div class="preview-toolbar">
        <button class="view-toggle btn-rules" onclick="setView('rules')"><i class="fas fa-eye"></i> –ü—Ä–∞–≤–∏–ª–∞</button>
        <button class="view-toggle btn-game" id="btn-game-toggle" onclick="setView('game')"><i class="fas fa-gamepad"></i> –ò–≥—Ä–∞</button>
    </div>
    <iframe id="preview"></iframe>
</main>

<script>
    const ASSETS = {
        bg: ['https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png', 'https://img.genially.com/67961b32a116fb001568a75e/fa2ab459-fec9-4ccd-97e3-254427b4ade0.png', 'https://img.genially.com/67961b32a116fb001568a75e/02b52ad4-9d31-4b21-a305-8fec6e8a4487.png'],
        char: ['https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png', 'https://img.genially.com/67961b32a116fb001568a75e/74b56fcf-5354-43dd-9c9a-f50facc9a9bf.png', 'https://img.genially.com/67961b32a116fb001568a75e/0feda2a1-485a-4654-8640-bf1adcc9f9ec.png'],
        plat: ['https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png', 'https://img.genially.com/67961b32a116fb001568a75e/bad37c6d-f04c-45c0-b954-807d79ec3a95.png', 'https://img.genially.com/67961b32a116fb001568a75e/c6775617-bde5-43e4-9da8-5332d928807e.png']
    };

    let data = {
        bg: ASSETS.bg[0], char: ASSETS.char[0], plat: ASSETS.plat[0],
        neon: '#48e2fe', view: 'rules',
        font: { family: 'Arial', qClr: '#000000', qSize: 40, aClr: '#000000', aSize: 18 },
        texts: { winH: "CONGRATULATIONS!", winS: "LEVEL COMPLETE", loseH: "YOU LOST!" },
        game: { lives: 5, time: 10 },
        levels: [{ name: "Level 1", questions: "I ___ a new bike.\nShe ___ got a brother.", answers: "have got | has got | is got\nhas | have | is" }]
    };

    function init() {
        renderGrid('bg-grid', 'bg');
        renderGrid('char-grid', 'char');
        renderGrid('plat-grid', 'plat');
        renderLevels();
        update();
    }

    function renderGrid(id, key) {
        const container = document.getElementById(id);
        container.innerHTML = ASSETS[key].map(url => `
            <div class="asset-box ${data[key] === url ? 'active' : ''}" onclick="selectAsset('${key}', '${url}')">
                <img src="${url}">
            </div>
        `).join('');
    }

    function selectAsset(key, url) {
        data[key] = url;
        document.getElementById('c-' + key).value = '';
        renderGrid(key + '-grid', key);
        update();
    }

    function renderLevels() {
        const list = document.getElementById('levels-list');
        list.innerHTML = data.levels.map((l, i) => `
            <div class="lvl-container">
                <div class="lvl-head">
                    <input type="text" value="${l.name}" oninput="data.levels[${i}].name=this.value;update()" style="width:70%">
                    <button onclick="data.levels.splice(${i},1);renderLevels();update()" style="background:none; border:none; color:#f87171; cursor:pointer"><i class="fas fa-trash"></i></button>
                </div>
                <div style="display:flex; gap:10px">
                    <div style="flex:1"><label>–í–û–ü–†–û–°–´</label><textarea oninput="data.levels[${i}].questions=this.value;update()">${l.questions}</textarea></div>
                    <div style="flex:1"><label>–û–¢–í–ï–¢–´ (–í–µ—Ä–Ω—ã–π | –ù–µ–≤–µ—Ä–Ω—ã–π)</label><textarea oninput="data.levels[${i}].answers=this.value;update()">${l.answers}</textarea></div>
                </div>
            </div>
        `).join('');
    }

    function addLevel() {
        data.levels.push({ name: "New Level", questions: "", answers: "" });
        renderLevels();
    }

    function setTab(name) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c => c.style.display = 'none');
        document.querySelector(`[onclick="setTab('${name}')"]`).classList.add('active');
        document.getElementById('tab-' + name).style.display = 'block';
    }

    function setView(v) { 
        data.view = v; 
        document.getElementById('btn-game-toggle').classList.toggle('active', v === 'game');
        update(); 
    }

    function update() {
        // Sync custom inputs
        ['bg', 'char', 'plat'].forEach(k => {
            const custom = document.getElementById('c-' + k).value;
            if(custom) data[k] = custom;
        });

        data.neon = document.getElementById('clr-neon').value;
        data.font = {
            family: document.getElementById('f-family').value,
            qClr: document.getElementById('f-q-clr').value,
            qSize: document.getElementById('f-q-size').value,
            aClr: document.getElementById('f-a-clr').value,
            aSize: document.getElementById('f-a-size').value
        };
        data.texts = {
            winH: document.getElementById('txt-win-h').value,
            winS: document.getElementById('txt-win-s').value,
            loseH: document.getElementById('txt-lose-h').value
        };
        data.game.lives = document.getElementById('g-lives').value;
        data.game.time = document.getElementById('g-time').value;

        document.getElementById('preview').srcdoc = generateFinalHTML(data);
    }

    function copyResult() {
        const code = generateFinalHTML(data, true);
        navigator.clipboard.writeText(code).then(() => alert("–ö–æ–¥ –≥–æ—Ç–æ–≤! –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ Genially."));
    }

    function generateFinalHTML(s, forceGame = false) {
        const lvlJson = JSON.stringify(s.levels.map(l => ({
            qs: l.questions.split('\n').filter(t => t.trim()),
            as: l.answers.split('\n').filter(t => t.trim()).map(line => line.split('|').map(a => a.trim()))
        })));

        return `
<!DOCTYPE html>
<html>
<head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap');
        body { margin: 0; overflow: hidden; font-family: ${s.font.family}; }
        #game-box { position: relative; width: 100vw; height: 100vh; background: url('${s.bg}') center/cover; }
        
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .modal { background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); border: 2px solid ${s.neon}; border-radius: 20px; padding: 40px; color: white; text-align: center; box-shadow: 0 0 30px ${s.neon}; width: 80%; }
        
        #hud { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; box-sizing: border-box; z-index: 50; }
        .stat-item { background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 20px; border: 1px solid ${s.neon}; color: white; font-weight: bold; }
        
        #q-container { position: absolute; top: 80px; width: 100%; text-align: center; }
        #q-txt { background: white; color: ${s.font.qClr}; font-size: ${s.font.qSize}px; padding: 15px 40px; border-radius: 15px; display: inline-block; font-weight: 900; }
        
        #hero { position: absolute; bottom: 15%; left: 50px; width: 120px; height: 120px; background: url('${s.char}') center/contain no-repeat; transition: 0.5s; z-index: 10; }
        
        #plats { position: absolute; bottom: 15%; width: 100%; display: flex; justify-content: center; gap: 40px; }
        .p-item { width: 150px; height: 150px; background: url('${s.plat}') center/contain no-repeat; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .ans-txt { color: ${s.font.aClr}; font-size: ${s.font.aSize}px; font-weight: 900; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 5px; }
        
        .btn-start { background: white; color: black; border: none; padding: 15px 40px; border-radius: 30px; font-size: 24px; font-weight: 900; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="game-box">
        <div id="hud">
            <div class="stat-item">‚≠ê <span id="score">0</span></div>
            <div class="stat-item" id="timer">00:${s.game.time}</div>
            <div class="stat-item"><span id="hearts"></span></div>
        </div>

        <div id="q-container"><div id="q-txt"></div></div>
        <div id="hero"></div>
        <div id="plats"></div>

        <div class="overlay" id="scr-rules" style="display: ${s.view === 'rules' && !forceGame ? 'flex' : 'none'}">
            <div class="modal">
                <img src="${s.char}" width="100">
                <h1>Leap & Learn</h1>
                <p>Select the correct answers to help the character cross!</p>
                <button class="btn-start" onclick="start()">START</button>
            </div>
        </div>

        <div class="overlay" id="scr-end" style="display:none">
            <div class="modal">
                <h1 id="end-h"></h1>
                <h3 id="end-s"></h3>
                <h2>Final Score: <span id="final-score"></span></h2>
                <button class="btn-start" onclick="location.reload()">REPLAY</button>
            </div>
        </div>
    </div>

    <script>
        const conf = { lvls: ${lvlJson}, lives: ${s.game.lives}, time: ${s.game.time} };
        let cLvl = 0, cQ = 0, score = 0, lives = conf.lives, timer;

        function start() {
            document.getElementById('scr-rules').style.display = 'none';
            updateHearts();
            loadQ();
        }

        function loadQ() {
            const lvl = conf.lvls[cLvl];
            if(!lvl) return end(true);
            if(cQ >= lvl.qs.length) { cLvl++; cQ = 0; return loadQ(); }

            document.getElementById('q-txt').innerText = lvl.qs[cQ];
            const answers = [...lvl.as[cQ]];
            const correct = answers[0];
            answers.sort(() => Math.random() - 0.5);

            const pDiv = document.getElementById('plats');
            pDiv.innerHTML = '';
            answers.forEach(a => {
                const p = document.createElement('div');
                p.className = 'p-item';
                p.innerHTML = '<span class="ans-txt">'+a+'</span>';
                p.onclick = () => {
                    if(a === correct) {
                        score += 10;
                        document.getElementById('score').innerText = score;
                        cQ++; loadQ();
                    } else {
                        lives--; updateHearts();
                        if(lives <= 0) end(false);
                    }
                };
                pDiv.appendChild(p);
            });
            resetTimer();
        }

        function resetTimer() {
            clearInterval(timer);
            let left = conf.time;
            timer = setInterval(() => {
                left--;
                document.getElementById('timer').innerText = '00:' + (left < 10 ? '0' : '') + left;
                if(left <= 0) { lives--; updateHearts(); if(lives <= 0) end(false); else loadQ(); }
            }, 1000);
        }

        function updateHearts() { document.getElementById('hearts').innerText = "‚ù§Ô∏è".repeat(lives); }

        function end(win) {
            clearInterval(timer);
            document.getElementById('scr-end').style.display = 'flex';
            document.getElementById('end-h').innerText = win ? "${s.texts.winH}" : "${s.texts.loseH}";
            document.getElementById('end-s').innerText = win ? "${s.texts.winS}" : "Try Again!";
            document.getElementById('final-score').innerText = score;
        }

        if("${s.view}" === 'game') start();
    <\/script>
</body>
</html>`;
    }

    init();
</script>
</body>
</html>
