<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Leap & Learn: Professional Builder v3.0</title>
    <style>
        /* –°—Ç–∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –æ—Å—Ç–∞—é—Ç—Å—è –ª–µ–≥–∫–∏–º–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã */
        :root { --accent: #7cf9ff; --bg: #050b1a; --panel: #142342; --text: #eaf6ff; }
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; height: 100vh; background: var(--bg); color: var(--text); overflow: hidden; }
        #sidebar { width: 480px; min-width: 480px; background: #0a1730; border-right: 1px solid #333; display: flex; flex-direction: column; box-shadow: 10px 0 30px rgba(0,0,0,0.5); z-index: 10; }
        .header { padding: 20px; background: var(--panel); border-bottom: 2px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .tabs { display: flex; background: #000; overflow-x: auto; border-bottom: 1px solid #333; }
        .tab { flex: 1; padding: 15px 10px; font-size: 11px; font-weight: bold; cursor: pointer; text-align: center; opacity: 0.5; transition: 0.3s; border-bottom: 3px solid transparent; text-transform: uppercase; }
        .tab.active { opacity: 1; border-bottom-color: var(--accent); background: rgba(124, 249, 255, 0.1); }
        .scroll-box { flex-grow: 1; overflow-y: auto; padding: 20px; scrollbar-width: thin; }
        .group { background: var(--panel); border-radius: 12px; padding: 18px; margin-bottom: 20px; border: 1px solid #2a3b5a; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h4 { margin: 0 0 15px 0; font-size: 12px; color: var(--accent); letter-spacing: 1.5px; border-bottom: 1px solid rgba(124, 249, 255, 0.2); padding-bottom: 5px; }
        label { display: block; font-size: 11px; margin-bottom: 6px; color: #94a3b8; }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; font-size: 13px; }
        .color-row { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        input[type="color"] { width: 45px; height: 45px; cursor: pointer; padding: 2px; background: #334155; border: none; border-radius: 4px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; text-transform: uppercase; font-size: 12px; }
        .btn-main { background: var(--accent); color: #000; width: 100%; box-shadow: 0 0 15px rgba(124, 249, 255, 0.3); }
        .btn-copy { background: #ffffff; color: #000; }
        #preview-container { flex-grow: 1; background: #000; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 1000; padding: 40px; align-items: center; justify-content: center; }
        .modal-box { background: var(--panel); width: 100%; max-width: 1000px; height: 85vh; border-radius: 20px; border: 2px solid var(--accent); display: flex; flex-direction: column; padding: 30px; }
        .qa-grid { display: flex; gap: 20px; flex: 1; min-height: 0; }
        .qa-col { flex: 1; display: flex; flex-direction: column; }
        .qa-col textarea { flex: 1; font-family: 'Courier New', monospace; font-size: 14px; background: #050a18; border: 1px solid #1e293b; color: #4ecca3; padding: 15px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="header">
        <h2 style="margin:0; font-size:18px; letter-spacing:1px;">LEAP & LEARN <span style="font-size:10px; opacity:0.6;">PRO</span></h2>
        <button class="btn btn-copy" onclick="copyResult()">üìã –ö–û–ü–ò–†–û–í–ê–¢–¨</button>
    </div>
    <div class="tabs">
        <div class="tab active" onclick="switchT('viz', this)">–í–ò–ó–£–ê–õ</div>
        <div class="tab" onclick="switchT('hero', this)">–ì–ï–†–û–ô</div>
        <div class="tab" onclick="switchT('game', this)">–ì–ï–ô–ú–ü–õ–ï–ô</div>
        <div class="tab" onclick="switchT('snd', this)">–ó–í–£–ö–ò</div>
        <div class="tab" onclick="switchT('lvl', this)">–£–†–û–í–ù–ò</div>
    </div>
    <div class="scroll-box">
        <div id="t-viz" class="pane">
            <div class="group">
                <h4>üé® –¶–≤–µ—Ç–∞ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>
                <div class="color-row"><input type="color" id="c-bg" value="#0a1730" oninput="upd()"><label>–§–æ–Ω —ç–∫—Ä–∞–Ω–æ–≤</label></div>
                <div class="color-row"><input type="color" id="c-ui" value="#7cf9ff" oninput="upd()"><label>–¶–≤–µ—Ç –ù–µ–æ–Ω–∞</label></div>
                <label><input type="checkbox" id="c-neon" checked onchange="upd()"> –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—á–µ–Ω–∏–µ</label>
            </div>
            <div class="group">
                <h4>üî† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–∫—Å—Ç–∞</h4>
                <div class="color-row"><input type="color" id="c-font" value="#ffffff" oninput="upd()"><label>–¶–≤–µ—Ç –±—É–∫–≤</label></div>
                <label>–†–∞–∑–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ (px)</label>
                <input type="number" id="f-size" value="32" oninput="upd()">
            </div>
        </div>
        <div id="t-hero" class="pane" style="display:none">
            <div class="group">
                <h4>üê∏ –ü–µ—Ä—Å–æ–Ω–∞–∂</h4>
                <input type="text" id="h-url" value="https://img.genially.com/67961b32a116fb001568a75e/3074df22-5c73-4ad2-b0b2-491c6fc247f3.png" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏..." oninput="upd()">
                <label>–§–æ–Ω (URL)</label>
                <input type="text" id="b-url" value="https://img.genially.com/67961b32a116fb001568a75e/c0c9010f-c3dd-42c1-b7c1-65024fa3aec6.png" oninput="upd()">
                <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (URL)</label>
                <input type="text" id="p-url" value="https://img.genially.com/67961b32a116fb001568a75e/ed6c6e82-953b-43d4-947d-e46227b760f0.png" oninput="upd()">
            </div>
        </div>
        <div id="t-game" class="pane" style="display:none">
            <div class="group">
                <h4>‚öôÔ∏è –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å</h4>
                <label>–í—Ä–µ–º—è (—Å–µ–∫)</label><input type="number" id="g-time" value="15" oninput="upd()">
                <label>–ñ–∏–∑–Ω–∏</label><input type="number" id="g-lives" value="3" oninput="upd()">
            </div>
        </div>
        <div id="t-snd" class="pane" style="display:none">
            <div class="group">
                <h4>üîä –ê—É–¥–∏–æ (URL mp3)</h4>
                <label>–í–µ—Ä–Ω–æ</label><input type="text" id="s-ok" oninput="upd()">
                <label>–û—à–∏–±–∫–∞</label><input type="text" id="s-no" oninput="upd()">
                <label>–ü–æ–±–µ–¥–∞</label><input type="text" id="s-win" oninput="upd()">
            </div>
        </div>
        <div id="t-lvl" class="pane" style="display:none">
            <div id="lvl-container"></div>
            <button class="btn btn-main" onclick="newLvl()">+ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
        </div>
    </div>
</div>

<div id="preview-container"><iframe id="f-view"></iframe></div>

<div id="modal">
    <div class="modal-box">
        <h2 id="m-head" style="color:var(--accent)">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–¥–∞–Ω–∏–π</h2>
        <div class="qa-grid">
            <div class="qa-col"><label>–í–æ–ø—Ä–æ—Å—ã</label><textarea id="m-q"></textarea></div>
            <div class="qa-col"><label>–û—Ç–≤–µ—Ç—ã (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π|–Ω–µ—Ç|–Ω–µ—Ç)</label><textarea id="m-a"></textarea></div>
        </div>
        <button class="btn btn-main" style="margin-top:20px" onclick="closeLvl()">–°–û–•–†–ê–ù–ò–¢–¨</button>
    </div>
</div>

<script>
    let levels = [{name: "–£—Ä–æ–≤–µ–Ω—å 1", q: ["2 + 2 ="], a: ["4|1|5"]}];
    let editIdx = 0;

    function switchT(id, el) {
        document.querySelectorAll('.pane').forEach(p => p.style.display = 'none');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('t-' + id).style.display = 'block';
        el.classList.add('active');
    }

    function newLvl() { levels.push({name: "–£—Ä–æ–≤–µ–Ω—å " + (levels.length+1), q: [""], a: [""]}); renderLvls(); }
    function renderLvls() {
        const c = document.getElementById('lvl-container'); c.innerHTML = '';
        levels.forEach((l, i) => {
            const d = document.createElement('div'); d.className = 'group';
            d.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><span>\${l.name}</span><button class="btn" style="background:var(--accent);color:#000" onclick="editLvl(\${i})">‚öôÔ∏è –ó–∞–¥–∞–Ω–∏—è</button></div>`;
            c.appendChild(d);
        });
        upd();
    }
    function editLvl(i) { editIdx = i; document.getElementById('m-head').innerText = levels[i].name; document.getElementById('m-q').value = levels[i].q.join('\n'); document.getElementById('m-a').value = levels[i].a.join('\n'); document.getElementById('modal').style.display = 'flex'; }
    function closeLvl() { levels[editIdx].q = document.getElementById('m-q').value.split('\n'); levels[editIdx].a = document.getElementById('m-a').value.split('\n'); document.getElementById('modal').style.display = 'none'; renderLvls(); }

    function upd() {
        const conf = {
            bg: document.getElementById('b-url').value,
            hero: document.getElementById('h-url').value,
            plat: document.getElementById('p-url').value,
            cUI: document.getElementById('c-ui').value,
            cFont: document.getElementById('c-font').value,
            fSize: document.getElementById('f-size').value,
            cBg: document.getElementById('c-bg').value,
            neon: document.getElementById('c-neon').checked,
            time: document.getElementById('g-time').value,
            lives: document.getElementById('g-lives').value,
            sfx: { ok: document.getElementById('s-ok').value, no: document.getElementById('s-no').value, win: document.getElementById('s-win').value },
            levels: levels
        };

        const code = `
<!DOCTYPE html>
<html>
<head>
    <style>
        :root { --accent: \${conf.cUI}; --fcolor: \${conf.cFont}; }
        body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family: 'Segoe UI', sans-serif; background:\${conf.cBg}; color:var(--fcolor); }
        #WRAP { width:100%; height:100%; position:relative; background:url('\${conf.bg}') center/cover no-repeat; }
        .ui-box { padding:12px 25px; background:rgba(0,0,0,0.8); border:2px solid var(--accent); border-radius:15px; font-weight:bold; box-shadow: \${conf.neon ? '0 0 20px var(--accent)' : 'none'}; }
        #HUD { position:absolute; top:25px; left:25px; display:flex; gap:20px; z-index:100; }
        #QUESTION { position:absolute; top:20%; width:100%; text-align:center; font-size:\${conf.fSize}px; padding:0 60px; box-sizing:border-box; text-shadow: 0 4px 10px #000; font-weight:800; }
        #PLAYER { position:absolute; bottom:15%; left:12%; width:130px; height:130px; background:url('\${conf.hero}') center/contain no-repeat; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index:10; }
        #PLATFORMS { position:absolute; bottom:15%; width:100%; display:flex; justify-content:center; gap:70px; }
        .platform { width:180px; height:180px; background:url('\${conf.plat}') center/contain no-repeat; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#000; font-size:20px; text-align:center; padding:30px; box-sizing:border-box; transition: transform 0.2s; }
        .platform:hover { transform: translateY(-10px) scale(1.05); }
        
        /* –≠–ö–†–ê–ù–´ */
        .full-screen { position:fixed; inset:0; background:rgba(6,12,28,0.98); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:2000; text-align:center; }
        .result-card { background:rgba(255,255,255,0.03); padding:40px; border-radius:30px; border:3px solid var(--accent); box-shadow: 0 0 40px rgba(0,0,0,0.5), \${conf.neon ? '0 0 30px var(--accent)' : 'none'}; min-width:400px; }
        .stat-line { display:flex; justify-content:space-between; font-size:24px; margin:15px 0; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px; }
        .btn-play { padding:18px 60px; background:var(--accent); color:#000; border:none; border-radius:15px; cursor:pointer; font-weight:900; font-size:22px; margin-top:30px; text-transform:uppercase; transition:0.3s; }
        .btn-play:hover { transform:scale(1.1); box-shadow: 0 0 30px var(--accent); }
        
        #FIREWORKS { position:fixed; inset:0; pointer-events:none; z-index:3000; }
    </style>
</head>
<body>
    <div id="WRAP">
        <div id="HUD">
            <div class="ui-box">‚ù§Ô∏è <span id="val-lives">\${conf.lives}</span></div>
            <div class="ui-box">‚è±Ô∏è <span id="val-timer">\${conf.time}</span></div>
            <div class="ui-box">‚≠ê <span id="val-score">0</span></div>
        </div>
        <div id="QUESTION">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="PLAYER"></div>
        <div id="PLATFORMS"></div>
    </div>

    <div id="SCREEN" class="full-screen">
        <h1 id="scr-title" style="font-size:60px; margin-bottom:10px; color:var(--accent);">LEAP & LEARN</h1>
        <div id="scr-body"></div>
        <button class="btn-play" id="scr-btn" onclick="initGame()">–ò–ì–†–ê–¢–¨</button>
    </div>

    <canvas id="FIREWORKS"></canvas>

    <script>
        const GAME_DATA = \${JSON.stringify(conf)};
        let cLvl=0, cQ=0, score=0, lScore=0, lives=GAME_DATA.lives, timer, timeLeft=0, totalPoints=0;
        const sndOk = new Audio(GAME_DATA.sfx.ok), sndNo = new Audio(GAME_DATA.sfx.no), sndWin = new Audio(GAME_DATA.sfx.win);

        function initGame() {
            document.getElementById('SCREEN').style.display='none';
            totalPoints=0; cLvl=0; lives=GAME_DATA.lives;
            startLvl();
        }

        function startLvl() {
            cQ=0; lScore=0;
            updateHUD();
            nextQ();
        }

        function nextQ() {
            clearInterval(timer);
            const qObj = GAME_DATA.levels[cLvl].q[cQ];
            const aList = GAME_DATA.levels[cLvl].a[cQ].split('|');
            document.getElementById('QUESTION').innerText = qObj;
            
            const pb = document.getElementById('PLATFORMS'); pb.innerHTML = '';
            const variants = aList.map((t, i) => ({ t, isCorrect: i===0 })).sort(()=>Math.random()-0.5);
            
            variants.forEach(v => {
                const d = document.createElement('div');
                d.className = 'platform'; d.innerText = v.t;
                d.onclick = () => handleAnswer(v.isCorrect);
                pb.appendChild(d);
            });

            timeLeft = GAME_DATA.time;
            document.getElementById('val-timer').innerText = timeLeft;
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('val-timer').innerText = timeLeft;
                if(timeLeft <= 0) handleAnswer(false);
            }, 1000);
        }

        function handleAnswer(isOk) {
            clearInterval(timer);
            if(isOk) {
                sndOk.play();
                const bonus = timeLeft * 10;
                lScore += (100 + bonus);
                cQ++;
                if(cQ >= GAME_DATA.levels[cLvl].q.length) showSummary();
                else nextQ();
            } else {
                sndNo.play();
                lives--;
                if(lives <= 0) showFinal(false);
                else nextQ();
            }
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('val-lives').innerText = lives;
            document.getElementById('val-score').innerText = totalPoints + lScore;
        }

        function showSummary() {
            const lifeBonus = lives * 100;
            const subTotal = lScore + lifeBonus;
            totalPoints += subTotal;

            const scr = document.getElementById('SCREEN');
            scr.style.display = 'flex';
            document.getElementById('scr-title').innerText = "–£–†–û–í–ï–ù–¨ –ü–†–û–ô–î–ï–ù!";
            document.getElementById('scr-body').innerHTML = \`
                <div class="result-card">
                    <div class="stat-line"><span>–û—á–∫–∏ –∑–∞ –æ—Ç–≤–µ—Ç—ã:</span> <span>\${lScore}</span></div>
                    <div class="stat-line"><span>–ë–æ–Ω—É—Å –∑–∞ –∂–∏–∑–Ω–∏:</span> <span>+\${lifeBonus}</span></div>
                    <div class="stat-line" style="border-top:2px solid var(--accent); padding-top:15px; font-weight:bold; color:var(--accent);">
                        <span>–ò–¢–û–ì–û:</span> <span>\${subTotal}</span>
                    </div>
                </div>
            \`;
            
            startFireworks();
            cLvl++;
            const btn = document.getElementById('scr-btn');
            if(cLvl < GAME_DATA.levels.length) {
                btn.innerText = "–°–õ–ï–î–£–Æ–©–ò–ô –£–†–û–í–ï–ù–¨";
                btn.onclick = () => { stopFireworks(); scr.style.display='none'; startLvl(); };
            } else showFinal(true);
        }

        function showFinal(isWin) {
            const scr = document.getElementById('SCREEN');
            scr.style.display = 'flex';
            document.getElementById('scr-title').innerText = isWin ? "–í–ï–õ–ò–ö–ê–Ø –ü–û–ë–ï–î–ê!" : "–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê";
            document.getElementById('scr-body').innerHTML = \`
                <div class="result-card">
                    <h2 style="font-size:40px;">–°–ß–ï–¢: \${totalPoints}</h2>
                    <p style="opacity:0.7">–£—Ä–æ–≤–Ω–µ–π –ø—Ä–æ–π–¥–µ–Ω–æ: \${cLvl} –∏–∑ \${GAME_DATA.levels.length}</p>
                </div>
            \`;
            document.getElementById('scr-btn').innerText = "–ò–ì–†–ê–¢–¨ –°–ù–ê–ß–ê–õ–ê";
            document.getElementById('scr-btn').onclick = () => location.reload();
            if(isWin) { sndWin.play(); startFireworks(); }
        }

        /* –ü–û–õ–ù–û–¶–ï–ù–ù–´–ô –î–í–ò–ñ–û–ö –°–ê–õ–Æ–¢–û–í */
        const canvas = document.getElementById('FIREWORKS');
        const ctx = canvas.getContext('2d');
        let particles = [], fwTimer;

        function startFireworks() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            fwTimer = setInterval(() => {
                const x = Math.random() * canvas.width;
                const y = Math.random() * (canvas.height / 2);
                const color = \`hsl(\${Math.random()*360}, 100%, 60%)\`;
                for(let i=0; i<50; i++) particles.push(new Particle(x, y, color));
            }, 500);
            updateParticles();
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.vx = Math.random() * 6 - 3; this.vy = Math.random() * 6 - 3;
                this.alpha = 1;
            }
            draw() {
                ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2); ctx.fill();
            }
            update() { this.x += this.vx; this.y += this.vy; this.alpha -= 0.01; }
        }

        function updateParticles() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            particles.forEach((p, i) => {
                p.update(); p.draw();
                if(p.alpha <= 0) particles.splice(i, 1);
            });
            if(fwTimer) requestAnimationFrame(updateParticles);
        }

        function stopFireworks() { clearInterval(fwTimer); fwTimer = null; ctx.clearRect(0,0,canvas.width, canvas.height); particles = []; }
    <\/script>
</body>
</html>\`;
        document.getElementById('f-view').srcdoc = code;
    }

    function copyResult() { navigator.clipboard.writeText(document.getElementById('f-view').srcdoc); alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!"); }
    renderLvls();
</script>
</body>
</html>
